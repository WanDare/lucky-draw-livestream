var j=Object.defineProperty;var K=(m,e,t)=>e in m?j(m,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[e]=t;var h=(m,e,t)=>K(m,typeof e!="symbol"?e+"":e,t);import{r as q,g as J}from"./phaser-CNtu8dn9.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();var Q=q();const D=J(Q);class Z extends D.Scene{constructor(){super({key:"LoadingScene"});h(this,"progressBar");h(this,"progressBox");h(this,"loadingText");h(this,"percentText")}preload(){const{width:t,height:s}=this.cameras.main;this.progressBox=this.add.graphics(),this.progressBox.fillStyle(2236962,.8),this.progressBox.fillRect(t/2-170,s/2-30,340,60),this.loadingText=this.make.text({x:t/2,y:s/2-50,text:"Loading...",style:{font:"Bold 28px Arial",color:"#ffffff",align:"center"}}).setOrigin(.5),this.percentText=this.make.text({x:t/2,y:s/2,text:"0%",style:{font:"24px Arial",color:"#ffffff",align:"center"}}).setOrigin(.5),this.progressBar=this.add.graphics();for(let r=0;r<30;r++)this.load.image(`dummy${r}`,"assets/images/ticket_prize.png");this.load.on("progress",r=>{this.progressBar.clear(),this.progressBar.fillStyle(227626,1),this.progressBar.fillRect(t/2-160,s/2-15,320*r,30),this.percentText.setText(`${Math.floor(r*100)}%`)});let a=!1,i=!1;this.load.on("complete",()=>{a=!0,n.call(this)}),this.time.delayedCall(1500,()=>{i=!0,n.call(this)});const n=()=>{a&&i&&(this.progressBar.destroy(),this.progressBox.destroy(),this.loadingText.destroy(),this.percentText.destroy(),this.scene.start("LuckyDrawScene"))}}}class ee{constructor(){h(this,"collected",[])}addPrize(e){this.collected.push(e)}getPrizes(){return[...this.collected]}clearPrizes(){this.collected=[]}setPrizes(e){this.collected=[...e]}}function te(m){return m.replace(/(\d{3}\s?\d{2})(\d{6})(\d{2})/,"$1XXXXXX$3")}class k{static create(e,t,s,a,i=209,n=65){const r=Math.max(12,n*.28),o=Math.max(14,n*.31),g=e.add.image(0,0,"card_bg").setDisplaySize(i,n).setOrigin(.5),c=e.add.text(0,-n*.25,a.name.toUpperCase(),{font:`bold ${r}px Poppins`,color:"#ffffff",align:"center",fontStyle:"bold",letterSpacing:-.32}).setOrigin(.5),p=e.add.text(0,n*.18,te(a.phone.toUpperCase()),{font:`bold ${o}px Poppins`,color:"#ffffff",align:"center",fontStyle:"bold",letterSpacing:-.4}).setOrigin(.5),l=e.add.container(t,s,[g,c,p]);return l.setDepth(22),l.setScale(.7).setAlpha(0),e.tweens.add({targets:l,alpha:1,scale:1,duration:200,ease:"Back.Out"}),l}}class se{static create(e,t,s){const a=t.x,i=t.y-t.displayHeight/2+30,n=e.add.image(a,i+95,"Displayprize").setOrigin(.5,0).setDisplaySize(420,130).setAlpha(0).setDepth(t.depth+1),r=e.add.image(a,220,s.image).setOrigin(.5,0).setDisplaySize(176,165).setAlpha(0).setDepth(t.depth+2),o=200,g=64,c=14,p=i+160,l=e.add.graphics();l.lineStyle(3,16383922,.85),l.strokeRoundedRect(-200/2,-64/2,o,g,c),l.fillStyle(2182678,1),l.fillRoundedRect(-200/2,-64/2,o,g,c),l.setPosition(a,p),l.setAlpha(0),l.setDepth(t.depth+3);const d=e.add.text(0,25,s.name.toUpperCase(),{font:"bold 16px Poppins",color:"#ffffff",align:"center",fontStyle:"normal",letterSpacing:-.32}).setOrigin(.5),u=e.add.text(0,45,s.value.toUpperCase(),{font:"bold 16px Poppins",color:"#ffffff",align:"center",fontStyle:"bold",fontSize:"24px"}).setOrigin(.5),f=e.add.container(a,p,[l,d,u]);return f.setDepth(t.depth+4),f.setScale(.7).setAlpha(0),e.tweens.add({targets:n,alpha:1,duration:350,ease:"Back.Out"}),e.tweens.add({targets:r,alpha:1,y:i,duration:360,delay:100,ease:"Back.Out"}),e.tweens.add({targets:f,alpha:1,scale:1,duration:350,delay:180,ease:"Back.Out"}),e.tweens.add({targets:l,alpha:1,duration:350,delay:180,ease:"Back.Out"}),[n,r,f,l]}}class N{static close(e,t,s,a){const i=e.scale.width;t.setX(0).setVisible(!0).setAlpha(1).setDepth(7),s.setX(i*.5).setVisible(!0).setAlpha(1).setDepth(7),e.tweens.add({targets:t,x:i*.25,duration:1500,ease:"Cubic.easeInOut"}),e.tweens.add({targets:s,x:i*.215,duration:1500,ease:"Cubic.easeInOut",onComplete:()=>{a&&a()}})}static open(e,t,s,a){const i=e.scale.width;t.setX(i*.25).setVisible(!0).setAlpha(1).setDepth(7),s.setX(i*.215).setVisible(!0).setAlpha(1).setDepth(7);let n=0;function r(){n+=1,n===2&&(t.setVisible(!1),s.setVisible(!1),a&&a())}e.tweens.add({targets:t,x:0,duration:1500,ease:"Cubic.easeInOut",onComplete:r}),e.tweens.add({targets:s,x:i*.5,duration:1500,ease:"Cubic.easeInOut",onComplete:r})}}function F(m,e){const t=(e==null?void 0:e.x)??720,s=(e==null?void 0:e.y)??512,a=(e==null?void 0:e.amount)??64,i=[16771899,15277667,5025616,240116,16750592,10233776,16777215];for(let n=0;n<a;n++){const r=Phaser.Math.FloatBetween(-120,-60),o=Phaser.Math.Between(400,900),g=Math.cos(Phaser.Math.DegToRad(r))*o,c=Math.sin(Phaser.Math.DegToRad(r))*o,p=i[Phaser.Math.Between(0,i.length-1)],l=Phaser.Math.Between(12,22),d=m.add.rectangle(t,s,l,l/3,p).setRotation(Phaser.Math.FloatBetween(0,Math.PI*2)).setAlpha(.85).setDepth(999);m.tweens.add({targets:d,x:t+g*1.2,y:s+c*1+Phaser.Math.Between(200,420),angle:Phaser.Math.Between(0,360),rotation:Phaser.Math.FloatBetween(0,Math.PI*4),alpha:.25,scaleX:Phaser.Math.FloatBetween(.7,1.3),scaleY:Phaser.Math.FloatBetween(.6,1.5),duration:Phaser.Math.Between(900,1500),ease:"Cubic.easeOut",onComplete:()=>d.destroy()})}}function ae(m){return m.replace(/(\d{3}\s?\d{2})(\d{6})(\d{2})/,"$1XXXXXX$3")}class R{static showCongrat(e,t,s){const{width:a,height:i}=e.scale,n=e.add.rectangle(a/2,i/2,a,i,0,.48).setDepth(300).setAlpha(0),r=e.add.image(a/2,i/2,"Congrat").setOrigin(.5).setDisplaySize(a,i).setDepth(2e3).setAlpha(0),o=Math.max(20),g=Math.max(28),c=e.add.text(a/2+50,i*.52,t.name.toUpperCase(),{font:`bold ${o}px Arial`,color:"#538B3C",align:"center",letterSpacing:-.32}).setOrigin(.5).setDepth(2001).setAlpha(0),p=e.add.text(a/2+50,i*.56,ae(t.phone.toUpperCase()),{font:`bold ${g}px Arial`,color:"#538B3C",align:"center",letterSpacing:-.48}).setOrigin(.5).setDepth(2001).setAlpha(0);e.tweens.add({targets:[n,r,c,p],alpha:1,duration:300,ease:"Quad.easeOut",onComplete:()=>{let l=!1;const d=()=>{l||(l=!0,e.tweens.add({targets:[n,r,c,p],alpha:0,duration:350,onComplete:()=>{n.destroy(),r.destroy(),c.destroy(),p.destroy(),s&&s()}}))};n.setInteractive({useHandCursor:!0}),r.setInteractive({useHandCursor:!0}),n.once("pointerdown",d),r.once("pointerdown",d),e.time.delayedCall(3e3,d)}})}static showTextOverlay(e,t,s,a,i){const{width:n,height:r}=e.scale,o=e.add.rectangle(n/2,r/2,n,r,0,.7).setDepth(250).setAlpha(0),g=Math.max(32,r*.053),c=e.add.text(n/2,r/2,t,{font:`bold ${g}px Arial`,color:s,align:"center"}).setOrigin(.5).setDepth(251).setAlpha(0);e.tweens.add({targets:[o,c],alpha:1,duration:350,ease:"Quad.easeIn",onComplete:()=>{i&&(F(e,{x:n/2,y:r/2,amount:70}),e.time.delayedCall(600,()=>{F(e,{x:n/2,y:r/2-r*.1,amount:48})})),e.time.delayedCall(1e3,()=>{e.tweens.add({targets:[o,c],alpha:0,duration:350,onComplete:()=>{o.destroy(),c.destroy(),a&&a()}})})}})}static showConfirm(e,t,s,a,i,n){const{width:r,height:o}=e.scale,g=e.add.rectangle(r/2,o/2,r,o,0,.5).setDepth(900),c=e.add.image(r/2,o/2,"card_bg").setOrigin(.5).setDisplaySize(r*.4,o*.25).setDepth(901),p=e.add.text(r/2,o/2-40,t,{font:`bold ${Math.max(24,o*.03)}px Arial`,color:"#ffffff",align:"center",wordWrap:{width:r*.5}}).setOrigin(.5).setDepth(902),l=128,d=48,u=(w,z,x,v,O)=>{const B=e.add.graphics();B.fillStyle(x,1),B.fillRoundedRect(-128/2,-48/2,l,d,12);const P=e.add.text(0,0,v,{font:"20px Arial",color:"#ffffff",align:"center"}).setOrigin(.5),_=e.add.zone(0,0,l,d).setOrigin(.5).setInteractive({useHandCursor:!0}),T=e.add.container(w,z,[B,P,_]).setDepth(902);return _.on("pointerdown",()=>{y(),O()}),T},f=u(r/2-100,o/2+40,43622,s,i),b=u(r/2+100,o/2+40,11141120,a,n),y=()=>{g.destroy(),c.destroy(),p.destroy(),f.destroy(),b.destroy()}}}class ie{static create(e,t,s,a){const i=["Drag1","Drag2","Drag3"];let n=0;const r=a.depth??5,o=e.add.image(0,0,i[0]).setOrigin(.5,0).setDisplaySize(133,88).setDepth(r).setAlpha(1).setInteractive({draggable:!0,useHandCursor:!0}),g=e.add.image(0,100,"DragText").setOrigin(.5,0).setDisplaySize(428,60).setDepth(r),c=e.add.container(t,300,[o,g]).setDepth(r);o.setInteractive({draggable:!0,useHandCursor:!0}),e.input.setDraggable(o);const p=e.time.addEvent({delay:400,loop:!0,callback:()=>{n=(n+1)%i.length,o.setTexture(i[n])}});let l=0,d=!1,u=!1;const f=48;return o.on("dragstart",b=>{l=c.y,d=!1,u=!1}),o.on("drag",(b,y,w)=>{if(d)return;u||(u=!0,e.tweens.add({targets:c,scale:.5,duration:120,yoyo:!0}));const z=l+80;c.y=D.Math.Clamp(w,l,z);const x=D.Math.Clamp((c.y-l)/(z-l),0,1);a.onDragProgress&&a.onDragProgress(x)}),o.on("dragend",b=>{u=!1,!d&&c.y>l+f?(d=!0,e.tweens.add({targets:c,y:l+56,scaleY:.5,duration:120,yoyo:!0,onComplete:()=>{p.remove(!1),c.destroy(),a.onDrop&&a.onDrop()}})):e.tweens.add({targets:c,y:l,scaleY:.5,duration:110})}),c}}class ne{static start(e,t,s,a){const i=["lightshow1","lightshow2","lightshow3","lightshow4"];let n=0;const r=(a==null?void 0:a.depth)??12,o=e.add.image(t,s,i[0]).setOrigin(.5).setDisplaySize(1150,250).setDepth(r),g=e.time.addEvent({delay:500,loop:!0,callback:()=>{n=(n+1)%i.length,o.setTexture(i[n])}});function c(){g.remove(!1),o.destroy()}return{image:o,stop:c}}}class re{static show(e,t,s,a){const i=e.scale.width,n=e.scale.height,r=i*.25,o=n/2,g=i*.5,c=n,p=3,l=i*.14,d=n*.063,u=i*.01,f=n*.086,b=i*.16,y=n*.024,w=n*.032,z=n*.078,x=i*.085,v=t.length===1?1:Math.ceil(t.length/p),O=t.length===1?d:v*d+(v-1)*u,B=f+y+O+w+z;let P=o-B/2;const _=e.add.image(r,o,"winner_blur_bg").setOrigin(.5).setDisplaySize(g,c).setDepth(1299).setAlpha(1),T=i*.75,I=n/2,M=e.add.image(T,I,"Poster").setOrigin(.5).setDisplaySize(g,c).setDepth(1301),A=e.add.image(r,P+f/2,a).setOrigin(.5).setDisplaySize(b,f+20).setDepth(1301).setAlpha(1);P+=f+y;const C=e.add.container(0,0).setDepth(1301).setAlpha(1);if(t.length===1){const S=k.create(e,r,P+d/2,t[0],l,d);C.add(S)}else{const S=l*p+u*(p-1);t.forEach((X,H)=>{const L=H%p,E=Math.floor(H/p),Y=r-S/2+L*(l+u)+l/2,$=P+E*(d+u)+d/2,U=k.create(e,Y,$,X,l,d);C.add(U)})}P+=O+w;const G=e.add.image(r,P+z/2,"Next").setOrigin(.5).setDisplaySize(x,z).setDepth(1301).setAlpha(1).setInteractive({useHandCursor:!0}),W=[_,M,A,C,G];return C.iterate(S=>W.push(S)),G.on("pointerdown",()=>{W.forEach(S=>S.destroy()),C.removeAll(!0),s&&s()}),W}}const V=["stage_label_giftbox","stage_label_aojiru","stage_label_iphone"],oe=["Stage1","Stage2","Stage3"];class le{constructor(e){h(this,"scene");h(this,"startButton");h(this,"background1");h(this,"background2");h(this,"gamescreen");h(this,"prizenet");h(this,"prizenetopen");h(this,"people");h(this,"thumbnail");h(this,"curtainOpen");h(this,"curtainLeft");h(this,"curtainRight");h(this,"transitionOverlay");h(this,"collectedPrizeGraphics",[]);h(this,"stageWinners",[]);h(this,"stagePrizeGraphics",[]);h(this,"isStartButtonDisabled",!1);h(this,"isNetOpen",!1);h(this,"isNetSliding",!1);h(this,"onStart");h(this,"onPopupClosed");this.scene=e}preload(){[["background1","assets/images/poster_thumbnail1.png"],["background2","assets/images/streaming_background.png"],["Thumbnail","assets/images/thumbnail.png"],["Poster","assets/images/poster.png"],["Gamescreen","assets/images/lucky_game_main_bg.png"],["winner_blur_bg","assets/images/blur2.png"],["Ball","assets/images/ticket_prize.png"],["Congrat","assets/images/popup_winner_screen.png"],["card_bg","assets/images/display_winner.png"],["Displayprize","assets/images/display_prize.png"],["People","assets/images/people.png"],["Start","assets/images/start_button.png"],["Next","assets/images/next_button.png"],["BackMenu","assets/images/back_to_menu.png"],["Prize","assets/images/prizes/prize7.png"],["Prize2","assets/images/prizes/prize6.png"],["Prize3","assets/images/prizes/prize8.png"],["Stage1","assets/images/stage1.png"],["Stage2","assets/images/stage2.png"],["Stage3","assets/images/stage3.png"],["stage_label_iphone","assets/images/stage_label_iphone.png"],["stage_label_aojiru","assets/images/stage_label_aojiro.png"],["stage_label_giftbox","assets/images/stage_label_giftbox.png"],["DragText","assets/images/drag_text.png"],["Curtain_left","assets/motions/curtain_left.png"],["Curtain_right","assets/motions/curtain_right.png"],["Curtainopen","assets/motions/curtain_open.png"],["lightshow1","assets/motions/light_show1.png"],["lightshow2","assets/motions/light_show2.png"],["lightshow3","assets/motions/light_show3.png"],["lightshow4","assets/motions/light_show4.png"],["Drag1","assets/motions/drag1.png"],["Drag2","assets/motions/drag2.png"],["Drag3","assets/motions/drag3.png"],["Prizenet","assets/motions/net_close.png"],["Prizenetopen","assets/motions/net_open.png"]].forEach(([t,s])=>this.scene.load.image(t,s))}reset(){this.stageWinners=[]}createLayout(e,t){const s=this.scene.scale.width,a=this.scene.scale.height;this.background1=this.scene.add.image(s*.25,a/2,"background1").setOrigin(.5).setDisplaySize(s*.5,a).setDepth(-1),this.background2=this.scene.add.image(s*.75,a/2,"background2").setOrigin(.5).setDisplaySize(s*.5,a).setDepth(9),this.curtainLeft=this.scene.add.image(0,a/2,"Curtain_left").setOrigin(1,.5).setDisplaySize(s*.25,a).setDepth(2).setAlpha(1).setVisible(!1),this.curtainRight=this.scene.add.image(s/2,a/2,"Curtain_right").setOrigin(0,.5).setDisplaySize(s*.29,a).setDepth(2).setAlpha(1).setVisible(!1),this.thumbnail=this.scene.add.image(s*.25,a/2,"Thumbnail").setOrigin(.5).setDisplaySize(s*.36,a*.71).setDepth(1),this.startButton=this.scene.add.image(s*.25,a*.94,"Start").setOrigin(.5).setDisplaySize(s*.1,a*.08).setDepth(1).setInteractive({useHandCursor:!1}),this.isStartButtonDisabled=!1,this.startButton.on("pointerdown",()=>{this.isStartButtonDisabled||(this.isStartButtonDisabled=!0,this.startButton.disableInteractive(),this.onStart&&this.onStart())}),this.gamescreen=null,this.prizenet=null,this.people=null,this.transitionOverlay=this.scene.add.rectangle(s/2,a/2,s,a,0,1).setDepth(100).setAlpha(0)}closeCurtain(e){N.close(this.scene,this.curtainLeft,this.curtainRight,e)}openCurtain(e){N.open(this.scene,this.curtainLeft,this.curtainRight,e)}runWithCurtain(e,t=0){this.closeCurtain(()=>{e(),t>0?setTimeout(()=>this.openCurtain(),t):this.openCurtain()})}slideOutPeople(e){this.people&&this.people.visible?this.scene.tweens.add({targets:this.people,y:this.scene.scale.height*1.2,duration:420,ease:"Cubic.easeIn",onComplete:()=>{var t;(t=this.people)==null||t.setVisible(!1),e&&e()}}):e&&e()}showGameScreen(e){var a;const t=this.scene.scale.width,s=this.scene.scale.height;(a=this.transitionOverlay)==null||a.setAlpha(0),this.curtainLeft.setX(t*.25).setVisible(!0).setAlpha(1),this.curtainRight.setX(t*.25).setVisible(!0).setAlpha(1),ne.start(this.scene,t*.257,s*.07,{size:t*.18,depth:5}),this.scene.tweens.add({targets:[this.curtainLeft,this.curtainRight],alpha:1,duration:0,onComplete:()=>{this.closeCurtain(()=>{var i;this.background1.setVisible(!1),this.startButton.setVisible(!1),this.thumbnail.setVisible(!1),this.gamescreen=this.scene.add.image(t*.25,s/2,"Gamescreen").setOrigin(.5).setDisplaySize(t*.5,s).setAlpha(1).setDepth(2),this.people=this.scene.add.image(t*.25,s*1.17,"People").setOrigin(.5).setDisplaySize(t*.6,s*.29).setAlpha(1).setDepth(8).setVisible(!0),this.scene.tweens.add({targets:this.people,y:s*.94,duration:520,ease:"Cubic.easeOut"}),this.prizenet=this.scene.add.image(t*.25,s*.21,"Prizenet").setOrigin(.5).setDisplaySize(t*.5,s*.49).setAlpha(1).setDepth(4),this.prizenetopen=this.scene.add.image(t*.25,s*.21,"Prizenetopen").setOrigin(.5).setDisplaySize(t*.5,s*.49).setAlpha(0).setDepth(3),(i=this.transitionOverlay)==null||i.setAlpha(0),ie.create(this.scene,t*.25,s*.018,{size:t*.007,depth:6,onDrop:e,onDragProgress:n=>{!this.prizenet||!this.prizenetopen||(n>.65&&!this.isNetOpen&&!this.isNetSliding?(this.isNetSliding=!0,this.scene.tweens.add({targets:this.prizenet,y:s*.02,alpha:0,duration:350,ease:"Cubic.easeIn"}),this.scene.tweens.add({targets:this.prizenetopen,alpha:1,duration:350,ease:"Cubic.easeIn",onComplete:()=>{this.isNetOpen=!0,this.isNetSliding=!1}})):n<=.65&&this.isNetOpen&&!this.isNetSliding&&(this.isNetSliding=!0,this.scene.tweens.add({targets:this.prizenet,y:s*.02,alpha:1,duration:350,ease:"Cubic.easeOut"}),this.scene.tweens.add({targets:this.prizenetopen,alpha:0,duration:350,ease:"Cubic.easeOut",onComplete:()=>{this.isNetOpen=!1,this.isNetSliding=!1}})))}}),this.openCurtain()})}})}showStagePrize(e){this.stagePrizeGraphics.forEach(s=>s.destroy()),this.stagePrizeGraphics=[];const t=se.create(this.scene,this.background2,e);this.stagePrizeGraphics.push(...t)}showStageWinnersPanel(e,t){this.stagePrizeGraphics.forEach(i=>i.destroy());const s=this.stageWinners.length,a=V[s]||"stage_label_iphone";this.stagePrizeGraphics=re.show(this.scene,e,()=>{this.stagePrizeGraphics.forEach(i=>i.destroy()),this.stagePrizeGraphics=[],t()},a),this.stageWinners.push([...e])}showPrizeCongratulation(e,t){R.showCongrat(this.scene,e,()=>{this.onPopupClosed&&this.onPopupClosed(),t&&t()})}showStageLabel(e){const t=this.scene.scale.width,s=this.scene.scale.height,a=oe[e]||"Stage1",i=this.scene.add.image(t*.25,s*.42,a).setOrigin(.5).setDepth(200).setDisplaySize(t*.22,s*.034);this.scene.tweens.add({targets:i,alpha:0,delay:1200,duration:400,onComplete:()=>i.destroy()})}showStageComplete(e){R.showTextOverlay(this.scene,"STAGE COMPLETE!","#00ffae",e,!1)}showGameComplete(){this.showGameCompleteSummary()}showGameCompleteSummary(){const e=this.scene.scale.width,t=this.scene.scale.height,s=e*.25,a=t/2,i=e*.5,n=t;this.scene.add.image(s,a,"winner_blur_bg").setOrigin(.5).setDisplaySize(i,n).setDepth(1500).setAlpha(1);const r=e*.75,o=t/2;this.scene.add.image(r,o,"Poster").setOrigin(.5).setDisplaySize(i,n).setDepth(1501);const g=t*.086,c=e*.16,p=t*.037,l=t*.035,d=e*.11,u=t*.048,f=e*.007,b=t*.01,y=4;let w=t*.034;[...this.stageWinners].reverse().forEach((P,_)=>{const T=this.stageWinners.length-1-_,I=V[T];I&&this.scene.textures.exists(I)&&this.scene.add.image(s,w+g/2,I).setOrigin(.5).setDisplaySize(c,g+20).setDepth(1502),w+=g+p;const M=[...P].reverse(),A=M.length;if(A===1)k.create(this.scene,s,w+u/2,M[0],d,u).setDepth(1502),w+=u;else if(A>1){const C=Math.ceil(A/y),G=C*u+(C-1)*b,W=y*d+(y-1)*f;for(let S=0;S<A;S++){const X=S%y,H=Math.floor(S/y),L=s-W/2+X*(d+f)+d/2,E=w+H*(u+b)+u/2;k.create(this.scene,L,E,M[S],d,u).setDepth(1502)}w+=G}w+=l});const x=this.scene.add.rectangle(0,0,e,t,0).setOrigin(0).setAlpha(0).setDepth(2e3),v=e*.06,O=t*.06;this.scene.add.image(v/2+e*.015,O/2+t*.025,"BackMenu").setOrigin(.5).setDisplaySize(v,O).setDepth(1503).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{this.scene.tweens.add({targets:x,alpha:1,duration:500,onComplete:()=>{this.scene.scene.restart()}})})}renderPrizePanel(e){this.collectedPrizeGraphics.forEach(l=>l.destroy()),this.collectedPrizeGraphics=[];const t=this.scene.scale.width,s=this.scene.scale.height,a=3,i=t*.14,n=s*.063,r=t*.007,o=i+r,g=n+r,c=t*.6,p=s*.32;e.forEach((l,d)=>{const u=d%a,f=Math.floor(d/a),b=c+u*o,y=p+f*g,w=k.create(this.scene,b,y,l,i,n);this.collectedPrizeGraphics.push(w)})}}const he="https://run.mocky.io/v3";class ce{constructor(e,t,s){h(this,"model");h(this,"view");h(this,"scene");h(this,"isCollectingPrize",!1);h(this,"stages",[{count:18,label:"Stage 1: ចាប់យកឲបាន 18 Ticket",winner:"អ្នកឈ្នះរង្វាន់"},{count:12,label:"Stage 2: ចាប់យកឲបាន 12 Ticket",winner:"អ្នកឈ្នះរង្វាន់"},{count:1,label:"Final Stage: ចាប់យកឲបាន 1 Ticket",winner:"អ្នកឈ្នះរង្វាន់"}]);h(this,"stagePrizes",[{image:"Prize",name:"Gift Yellow Box",value:"18 ​​រង្វាន់"},{image:"Prize2",name:"Sakkin Aojiru Box",value:"12 ​រង្វាន់"},{image:"Prize3",name:"IPHONE 16 PRO MAX",value:"1 ​​រង្វាន់"}]);h(this,"currentStage",0);h(this,"maxCollect",0);h(this,"ballPairs",[]);h(this,"ballSpawnTimer");h(this,"stageWinners",[]);this.model=e,this.view=t,this.scene=s,this.view.onStart=()=>this.onStartGame(),this.view.onPopupClosed=()=>{this.isCollectingPrize=!1,this.resumeAllBalls()}}hasSavedGame(){return!!localStorage.getItem("luckyDrawState")}saveGameState(){const e={currentStage:this.currentStage,prizes:this.model.getPrizes(),stageWinners:this.stageWinners};localStorage.setItem("luckyDrawState",JSON.stringify(e))}loadGameState(){const e=localStorage.getItem("luckyDrawState");if(e)try{const t=JSON.parse(e);this.currentStage=t.currentStage??0,this.stageWinners=t.stageWinners??[],this.model.setPrizes(t.prizes??[])}catch(t){console.error("Failed to load saved state",t)}}clearGameState(){localStorage.removeItem("luckyDrawState")}onStartGame(){this.hasSavedGame()?R.showConfirm(this.scene,"Do want to continue the previous game?","Resume","Restart",()=>{this.loadGameState(),this.view.reset(),this.stageWinners.forEach(e=>this.view.showStageWinnersPanel(e,()=>{})),this.currentStage>=this.stages.length?this.view.showGameCompleteSummary():this.view.renderPrizePanel(this.model.getPrizes()),this.curtainStageTransition(()=>this.startStage(this.currentStage))},()=>{this.clearGameState(),this.currentStage=0,this.stageWinners=[],this.curtainStageTransition(()=>this.startStage(0))}):(this.clearGameState(),this.currentStage=0,this.stageWinners=[],this.curtainStageTransition(()=>this.startStage(0)))}startStage(e){var t,s;this.clearAllBalls(),this.model.getPrizes().length===0&&this.model.clearPrizes(),this.view.renderPrizePanel(this.model.getPrizes()),this.maxCollect=this.stages[e].count,(s=(t=this.view).showStageLabel)==null||s.call(t,e),this.view.showGameScreen(()=>this.startInfiniteBallDrop()),this.view.showStagePrize(this.stagePrizes[e])}async fetchRandomPrizeInfo(){const e=await fetch(`${he}/7f5f5d5f-168b-404c-bec0-d226ccc4763e`);if(!e.ok)throw new Error("Failed to fetch prize info");const t=await e.json();return Array.isArray(t)?t[Math.floor(Math.random()*t.length)]:t}startInfiniteBallDrop(){this.ballSpawnTimer&&this.ballSpawnTimer.remove(!1),this.ballSpawnTimer=this.scene.time.addEvent({delay:300,loop:!0,callback:()=>{var e;if(this.model.getPrizes().length>=this.maxCollect){(e=this.ballSpawnTimer)==null||e.remove(!1);return}this.spawnBall()}})}spawnBall(){const{width:e,height:t}=this.scene.scale,s=Phaser.Math.Between(e*.015,e*.47),a=t*.16,i=Math.max(e,t)*.07,n=this.scene.add.image(s,a,"Ball").setOrigin(.5).setDisplaySize(i,i).setDepth(2).setInteractive({useHandCursor:!0});n.setAngle(Phaser.Math.Between(-45,45));const r=this.scene.tweens.add({targets:n,y:t*.98,angle:Phaser.Math.Between(-270,270),ease:"Sine.easeInOut",duration:Phaser.Math.Between(8500,15e3),delay:Phaser.Math.Between(0,700),onComplete:()=>{this.ballPairs=this.ballPairs.filter(o=>o.ball!==n),n.active&&n.destroy()}});this.ballPairs.push({ball:n,tween:r}),n.on("pointerdown",async()=>{if(!(this.isCollectingPrize||this.model.getPrizes().length>=this.maxCollect)){this.isCollectingPrize=!0,n.disableInteractive();try{const o=await this.fetchRandomPrizeInfo();this.collectPrizeWithAnimation(n,o)}catch(o){n.setInteractive({useHandCursor:!0}),this.isCollectingPrize=!1,console.error("Prize fetch failed",o)}}})}collectPrizeWithAnimation(e,t){const{width:s,height:a}=this.scene.scale;this.pauseAllBalls(),this.view.showPrizeCongratulation(t);const i=this.model.getPrizes().length,n=i%3,r=Math.floor(i/3),o=s*.14,g=a*.063,c=s*.007,p=s*.6+n*(o+c),l=a*.32+r*(g+c),d=this.scene.add.image(e.x,e.y,"Ball").setOrigin(.5).setDisplaySize(g,g).setDepth(100);this.scene.tweens.add({targets:d,x:p,y:l,scale:1.3,alpha:.6,duration:700,ease:"Cubic.easeIn",onComplete:()=>{d.destroy(),this.model.addPrize(t),this.view.renderPrizePanel(this.model.getPrizes()),this.saveGameState(),this.model.getPrizes().length>=this.maxCollect&&this.onStageComplete()}}),this.scene.tweens.add({targets:e,scale:1.4,alpha:0,duration:200,onComplete:()=>{e.destroy(),this.ballPairs=this.ballPairs.filter(u=>u.ball!==e)}})}pauseAllBalls(){this.ballPairs.forEach(e=>{e.ball.active&&e.tween&&!e.tween.paused&&(e.tween.pause(),e.ball.disableInteractive())}),this.ballSpawnTimer&&(this.ballSpawnTimer.paused=!0)}resumeAllBalls(){this.ballPairs.forEach(e=>{e.ball.active&&e.tween&&e.tween.paused&&(e.tween.resume(),e.ball.setInteractive({useHandCursor:!0}))}),this.ballSpawnTimer&&(this.ballSpawnTimer.paused=!1)}onStageComplete(){this.clearAllBalls();const e=this.model.getPrizes();this.view.collectedPrizeGraphics.forEach(t=>t.destroy()),this.view.collectedPrizeGraphics=[],this.view.slideOutPeople(()=>{this.view.showStageWinnersPanel(e,()=>{this.stageWinners.push([...e]),this.currentStage++,this.currentStage<this.stages.length?(this.model.clearPrizes(),this.saveGameState(),this.curtainStageTransition(()=>this.startStage(this.currentStage))):(this.clearGameState(),this.curtainStageTransition(()=>{var t,s;(s=(t=this.view).showGameComplete)==null||s.call(t)}))})})}clearAllBalls(){this.ballPairs.forEach(e=>{var t,s;(t=e.tween)!=null&&t.isPlaying()&&e.tween.stop(),(s=e.ball)!=null&&s.active&&e.ball.destroy()}),this.ballPairs=[],this.ballSpawnTimer&&(this.ballSpawnTimer.remove(!1),this.ballSpawnTimer=void 0)}curtainStageTransition(e){this.view.closeCurtain(()=>{e(),this.view.openCurtain()})}}class de extends D.Scene{constructor(){super({key:"LuckyDrawScene"});h(this,"model");h(this,"view")}preload(){this.model=new ee,this.view=new le(this),this.view.preload()}create(){const t=this.cameras.main.centerX,s=this.cameras.main.centerY;this.view.createLayout(t,s),this.view.createLayout(t,s),new ce(this.model,this.view,this)}}const ge={type:D.AUTO,width:1920,height:1080,backgroundColor:"#538b3c",scene:[Z,de],parent:"game",scale:{mode:D.Scale.FIT,autoCenter:D.Scale.CENTER_BOTH,width:1920,height:1080}};new D.Game(ge);
