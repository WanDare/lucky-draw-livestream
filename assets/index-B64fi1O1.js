var Z=Object.defineProperty;var ee=(l,e,t)=>e in l?Z(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var p=(l,e,t)=>ee(l,typeof e!="symbol"?e+"":e,t);import{r as te,g as se}from"./phaser-CNtu8dn9.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();var ae=te();const T=se(ae);class ie extends T.Scene{constructor(){super({key:"LoadingScene"});p(this,"progressBar");p(this,"progressBox");p(this,"loadingText");p(this,"percentText")}preload(){const{width:t,height:s}=this.cameras.main;this.progressBox=this.add.graphics(),this.progressBox.fillStyle(2236962,.8),this.progressBox.fillRect(t/2-170,s/2-30,340,60),this.progressBar=this.add.graphics(),this.loadingText=this.make.text({x:t/2,y:s/2-50,text:"Loading...",style:{font:"bold 28px Arial",color:"#ffffff",align:"center"}}).setOrigin(.5),this.percentText=this.make.text({x:t/2,y:s/2,text:"0%",style:{font:"24px Arial",color:"#ffffff",align:"center",shadow:{offsetX:1,offsetY:1,color:"#000000",blur:2,stroke:!1,fill:!0}}}).setOrigin(.5);for(let r=0;r<30;r++)this.load.image(`dummy${r}`,"assets/images/ticket_prize.png");this.load.on("progress",r=>{this.progressBar.clear(),this.progressBar.fillStyle(227626,1),this.progressBar.fillRect(t/2-160,s/2-15,320*r,30),this.percentText.setText(`${Math.floor(r*100)}%`)});let a=!1,i=!1;this.load.on("complete",()=>{a=!0,n.call(this)}),this.time.delayedCall(1500,()=>{i=!0,n.call(this)});const n=()=>{a&&i&&(this.progressBar.destroy(),this.progressBox.destroy(),this.loadingText.destroy(),this.percentText.destroy(),this.scene.start("LuckyDrawScene"))}}}class ne{constructor(){p(this,"collected",[]);p(this,"preloadedWinners",[])}addPrize(e){this.collected.push(e)}getPrizes(){return[...this.collected]}clearPrizes(){this.collected=[]}setPrizes(e){this.collected=[...e]}setPreloadedWinners(e){this.preloadedWinners=e}getPreloadedWinners(){return this.preloadedWinners}removePreloadedWinnerByPhone(e){this.preloadedWinners=this.preloadedWinners.filter(t=>t.phone!==e)}}function re(l){const e=l.replace(/\D/g,"");if(e.length<11)return l;const t=e.slice(0,3),s=e.slice(3,5),a=e.slice(-2);return`${t} ${s}XXXXXX${a}`}function oe(l){return/[\u1780-\u17FF]/.test(l)}function le(l,e){return l.length>e?l.slice(0,e-3)+"...":l}class W{static create(e,t,s,a,i=209,n=65){const f=e.add.image(0,0,"card_bg").setDisplaySize(i,n).setOrigin(.5),g=oe(a.name),h=g?"Kantumruy Pro":"Poppins";let d=g?a.name:a.name.toUpperCase();d=le(d,18);const u=e.add.text(0,0,d,{font:`14px ${h}`,color:"#ffffff",align:"center",fontStyle:"400",wordWrap:{width:i-2*12,useAdvancedWrap:!0}}).setOrigin(.5,0),w=e.add.text(0,0,re(a.phone),{font:"18px Poppins",color:"#ffffff",align:"center",fontStyle:"600",letterSpacing:-.4,wordWrap:{width:i-2*12,useAdvancedWrap:!0}}).setOrigin(.5,0),P=u.height+8+w.height;u.y=-P/2,w.y=u.y+u.height+8;const b=e.add.container(t,s,[f,u,w]);return b.setDepth(22),b.setScale(.7).setAlpha(0),e.tweens.add({targets:b,alpha:1,scale:1,duration:200,ease:"Back.Out"}),b}}class he{static create(e,t,s){const a=t.x,i=t.y-t.displayHeight/2+30,n=e.add.image(a,i+143,"Displayprize").setOrigin(.5,0).setDisplaySize(270,80).setAlpha(0).setDepth(t.depth+1),r=e.add.image(a,220,s.image).setOrigin(.5,0).setDisplaySize(154,161).setAlpha(0).setDepth(t.depth+2),o=175,m=64,c=i+190,f=e.add.image(0,0,"Prize_card").setDisplaySize(o,m).setOrigin(.5),g=e.add.text(0,0,s.name.toUpperCase(),{fontSize:16,fontFamily:"Poppins",fontStyle:"bold",color:"#ffffff",align:"center",letterSpacing:-.32,wordWrap:{width:o-16,useAdvancedWrap:!0}}).setOrigin(.5,0),h=e.add.text(0,0,s.value.toUpperCase(),{font:"bold 16px Poppins",color:"#ffffff",align:"center",fontStyle:"bold",fontSize:"24px",wordWrap:{width:o-16,useAdvancedWrap:!0}}).setOrigin(.5),d=15,u=g.height+h.height+d;g.y=-u/2+3,h.y=g.y+g.height+d;const w=e.add.container(a,c,[f,g,h]);return w.setDepth(t.depth+4),w.setScale(.7).setAlpha(0),e.tweens.add({targets:n,alpha:1,duration:350,ease:"Back.Out"}),e.tweens.add({targets:r,alpha:1,y:i,duration:360,delay:100,ease:"Back.Out"}),e.tweens.add({targets:w,alpha:1,scale:1,duration:350,delay:180,ease:"Back.Out"}),[n,r,w]}}class V{static close(e,t,s,a){const i=e.scale.width;t.setX(0).setVisible(!0).setAlpha(1).setDepth(7),s.setX(i*.5).setVisible(!0).setAlpha(1).setDepth(7),e.tweens.add({targets:t,x:i*.25,duration:1500,ease:"Cubic.easeInOut"}),e.tweens.add({targets:s,x:i*.215,duration:1500,ease:"Cubic.easeInOut",onComplete:()=>{a&&a()}})}static open(e,t,s,a){const i=e.scale.width;t.setX(i*.25).setVisible(!0).setAlpha(1).setDepth(7),s.setX(i*.215).setVisible(!0).setAlpha(1).setDepth(7);let n=0;function r(){n+=1,n===2&&(t.setVisible(!1),s.setVisible(!1),a&&a())}e.tweens.add({targets:t,x:0,duration:1500,ease:"Cubic.easeInOut",onComplete:r}),e.tweens.add({targets:s,x:i*.5,duration:1500,ease:"Cubic.easeInOut",onComplete:r})}}function K(l,e){const t=(e==null?void 0:e.x)??720,s=(e==null?void 0:e.y)??512,a=(e==null?void 0:e.amount)??64,i=[16771899,15277667,5025616,240116,16750592,10233776,16777215];for(let n=0;n<a;n++){const r=Phaser.Math.FloatBetween(-120,-60),o=Phaser.Math.Between(400,900),m=Math.cos(Phaser.Math.DegToRad(r))*o,c=Math.sin(Phaser.Math.DegToRad(r))*o,f=i[Phaser.Math.Between(0,i.length-1)],g=Phaser.Math.Between(12,22),h=l.add.rectangle(t,s,g,g/3,f).setRotation(Phaser.Math.FloatBetween(0,Math.PI*2)).setAlpha(.85).setDepth(999);l.tweens.add({targets:h,x:t+m*1.2,y:s+c*1+Phaser.Math.Between(200,420),angle:Phaser.Math.Between(0,360),rotation:Phaser.Math.FloatBetween(0,Math.PI*4),alpha:.25,scaleX:Phaser.Math.FloatBetween(.7,1.3),scaleY:Phaser.Math.FloatBetween(.6,1.5),duration:Phaser.Math.Between(900,1500),ease:"Cubic.easeOut",onComplete:()=>h.destroy()})}}function ce(l){const e=l.replace(/\D/g,"");if(e.length<11)return l;const t=e.slice(0,5),s="XXXXXX",a=e.slice(-2);return`${t}${s}${a}`}function de(l){return/[\u1780-\u17FF]/.test(l)}function ge(l,e){return l.length>e?l.slice(0,e-3)+"...":l}class N{static showCongrat(e,t,s){const{width:a,height:i}=e.scale,n=e.add.rectangle(a/2,i/2,a,i,0,.48).setDepth(300).setAlpha(0),r=e.add.image(a/2,i/2,"Congrat").setOrigin(.5).setDisplaySize(a,i).setDepth(2e3).setAlpha(0),o=Math.max(18),m=Math.max(28),c=de(t.name),f=c?"Kantumruy Pro":"Poppins";let g=c?t.name:t.name.toUpperCase();g=ge(g,20);const h=e.add.text(a/2+50,i*.525,g,{font:`${o}px ${f}`,color:"#538B3C",align:"center",fontStyle:"400",wordWrap:{width:a*.3,useAdvancedWrap:!0}}).setOrigin(.5).setDepth(2001).setAlpha(0),d=e.add.text(a/2+50,i*.555,ce(String(t.phone).toUpperCase()),{font:`bold ${m}px Arial`,color:"#538B3C",align:"center",letterSpacing:-.48}).setOrigin(.5).setDepth(2001).setAlpha(0);e.tweens.add({targets:[n,r,h,d],alpha:1,duration:300,ease:"Quad.easeOut",onComplete:()=>{let u=!1;const w=()=>{u||(u=!0,e.tweens.add({targets:[n,r,h,d],alpha:0,duration:350,onComplete:()=>{n.destroy(),r.destroy(),h.destroy(),d.destroy(),s&&s()}}))};n.setInteractive({useHandCursor:!0}),r.setInteractive({useHandCursor:!0}),n.once("pointerdown",w),r.once("pointerdown",w),e.time.delayedCall(3e3,w)}})}static showTextOverlay(e,t,s,a,i){const{width:n,height:r}=e.scale,o=e.add.rectangle(n/2,r/2,n,r,0,.7).setDepth(250).setAlpha(0),m=Math.max(32,r*.053),c=e.add.text(n/2,r/2,t,{font:`bold ${m}px Arial`,color:s,align:"center"}).setOrigin(.5).setDepth(251).setAlpha(0);e.tweens.add({targets:[o,c],alpha:1,duration:350,ease:"Quad.easeIn",onComplete:()=>{i&&(K(e,{x:n/2,y:r/2,amount:70}),e.time.delayedCall(600,()=>{K(e,{x:n/2,y:r/2-r*.1,amount:48})})),e.time.delayedCall(1e3,()=>{e.tweens.add({targets:[o,c],alpha:0,duration:350,onComplete:()=>{o.destroy(),c.destroy(),a&&a()}})})}})}static showConfirm(e,t,s,a,i,n){const{width:r,height:o}=e.scale,m=e.add.rectangle(r/2,o/2,r,o,0,.5).setDepth(900),c=e.add.image(r/2,o/2,"Pause").setOrigin(.5).setScale(1).setDisplaySize(r*.4,o*.25).setDepth(901),f=e.add.text(r/2,o/2-40,t,{font:`bold ${Math.max(24,o*.03)}px Arial`,color:"#ffffff",align:"center",wordWrap:{width:r*.5}}).setOrigin(.5).setDepth(902),g=128,h=48,d=(b,z,D,x,S)=>{const y=e.add.graphics();y.fillStyle(D,1),y.fillRoundedRect(-128/2,-48/2,g,h,12);const v=e.add.text(0,0,x,{font:"20px Arial",color:"#ffffff",align:"center"}).setOrigin(.5),C=e.add.zone(0,0,g,h).setOrigin(.5).setInteractive({useHandCursor:!0}),_=e.add.container(b,z,[y,v,C]).setDepth(902);return C.on("pointerdown",()=>{P(),S()}),_},u=d(r/2-100,o/2+40,43622,s,i),w=d(r/2+100,o/2+40,11141120,a,n),P=()=>{m.destroy(),c.destroy(),f.destroy(),u.destroy(),w.destroy()}}}function pe(l,e,t,s,a){const i=l.textures.createCanvas(e,t,s);if(!i)throw new Error("Failed to create canvas texture.");const n=i.getContext(),r=n.createLinearGradient(0,0,t,0);return a.length>1?(r.addColorStop(0,a[0]),r.addColorStop(.5,a[1]),a.length>2&&r.addColorStop(1,a[2])):a.length===1&&(r.addColorStop(0,a[0]),r.addColorStop(1,a[0])),n.fillStyle=r,n.fillRect(0,0,t,s),i.refresh(),i}function U(l,e,t,s,a,i,n,r,o,m={},c=8){const f=l.add.text(0,0,s.toUpperCase(),{fontFamily:n,fontSize:`${a}px`,fontStyle:r,align:"center",color:"#fff",lineSpacing:c,wordWrap:{width:i,useAdvancedWrap:!0},...m}).setOrigin(.5,.5),g=`gradient-${T.Math.RND.uuid()}`;pe(l,g,i,f.height,o);const h=l.add.image(0,0,g).setOrigin(.5,.5);h.setMask(f.createBitmapMask());const d=l.add.container(e,t,[h,f]);return d.setSize(i,f.height),d.on("destroy",()=>{l.textures.exists(g)&&l.textures.remove(g)}),d}function R(l,e,t,s,a,i={}){const{spacing:n=10,depth:r=1502,titleFontSize:o=34,subtitleFontSize:m=24,gradientColors:c=["#FFF7D5","#FFFFFF","#FDF5DB"],width:f=380,subtitleStyle:g={fontFamily:"Kantumruy Pro",fontSize:`${m}px`,fontStyle:"normal",align:"center",color:"#FFFFFF",stroke:"#765934",strokeThickness:2,shadow:{offsetX:1,offsetY:2,color:"#765934",blur:0,stroke:!0,fill:!0},lineSpacing:7}}=i;let h;typeof s=="string"?h=[{text:s,fontSize:o,fontFamily:"Kantumruy Pro",fontStyle:"bold",gradientColors:c,stroke:"#765934",strokeThickness:2,shadow:{offsetX:1,offsetY:2,color:"#765934",blur:0,stroke:!0,fill:!0}}]:h=s.map(S=>({fontFamily:S.fontFamily||"Kantumruy Pro",fontSize:S.fontSize||o,fontStyle:S.fontStyle||"normal",gradientColors:S.gradientColors||c,stroke:S.stroke??"#765934",strokeThickness:S.strokeThickness??2,shadow:S.shadow??{offsetX:1,offsetY:2,color:"#765934",blur:0,stroke:!0,fill:!0},...S}));const d=[];let u=0;for(const[S,y]of h.entries()){const v=U(l,0,0,y.text,y.fontSize||o,f,y.fontFamily||"Kantumruy Pro",y.fontStyle||"normal",y.gradientColors||c,{stroke:y.stroke,strokeThickness:y.strokeThickness,shadow:y.shadow},Math.round((y.fontSize||o)*.45));v.y=u,u+=v.height+(S<h.length-1?n:0),d.push(v)}const w=a.map(S=>l.add.text(0,0,S.toUpperCase(),{...g,fontSize:`${m}px`}).setOrigin(.5,0)),P=u,b=w.reduce((S,y)=>S+y.height+n,0)-(a.length>0?n:0),z=P+(a.length>0?n:0)+b;let D=-z/2;for(const S of d)S.y=D+S.height/2,D+=S.height+n;for(const S of w)S.y=D,D+=S.height+n;const x=l.add.container(e,t,[...d,...w]);return x.setDepth(r),x.setSize(f,z),x}class ue{static create(e,t,s,a){const i=["Drag1","Drag2","Drag3"];let n=0;const r=a.depth??5,o=e.add.image(0,0,i[0]).setOrigin(.5,0).setDisplaySize(133,88).setDepth(r).setAlpha(1).setInteractive({draggable:!0,useHandCursor:!0}),m=U(e,0,130,"ចាប់ផ្តើមចាប់សន្លឹកឆ្នោត",34,428,"Kantumruy Pro","bold",["#FFF7D5","#FFFFFF","#FDF5DB"],{stroke:"#765934",strokeThickness:2,shadow:{offsetX:1,offsetY:2,color:"#765934",blur:0,stroke:!0,fill:!0}}),c=e.add.container(t,300,[o,m]).setDepth(r);o.setInteractive({draggable:!0,useHandCursor:!0}),e.input.setDraggable(o);const f=e.time.addEvent({delay:400,loop:!0,callback:()=>{n=(n+1)%i.length,o.setTexture(i[n])}});let g=0,h=!1,d=!1;const u=48;return o.on("dragstart",w=>{g=c.y,h=!1,d=!1}),o.on("drag",(w,P,b)=>{if(h)return;d||(d=!0,e.tweens.add({targets:c,scale:.5,duration:120,yoyo:!0}));const z=g+80;c.y=T.Math.Clamp(b,g,z);const D=T.Math.Clamp((c.y-g)/(z-g),0,1);a.onDragProgress&&a.onDragProgress(D)}),o.on("dragend",w=>{d=!1,!h&&c.y>g+u?(h=!0,e.tweens.add({targets:c,y:g+56,scaleY:.5,duration:120,yoyo:!0,onComplete:()=>{f.remove(!1),c.destroy(),a.onDrop&&a.onDrop()}})):e.tweens.add({targets:c,y:g,scaleY:.5,duration:110})}),c}}class me{static start(e,t,s,a){const i=["lightshow1","lightshow2","lightshow3","lightshow4"];let n=0;const r=(a==null?void 0:a.depth)??12,o=e.add.image(t,s,i[0]).setOrigin(.5).setDisplaySize(1150,250).setDepth(r),m=e.time.addEvent({delay:500,loop:!0,callback:()=>{n=(n+1)%i.length,o.setTexture(i[n])}});function c(){m.remove(!1),o.destroy()}return{image:o,stop:c}}}class fe{static show(e,t,s,a,i,n){const r=e.scale.width,o=e.scale.height,m=r*.25,c=o/2,f=r*.5,g=o,h=4,d=r*.11,u=72,w=r*.01,P=o*.086,b=o*.024,z=o*.032,D=o*.078,x=r*.085,S=t.length===1?1:Math.ceil(t.length/h),y=t.length===1?u:S*u+(S-1)*w,v=P+b+y+z+D;let C=c-v/2;const _=e.add.image(m,c,"winner_blur_bg").setOrigin(.5).setDisplaySize(f,g).setDepth(1299).setAlpha(1),I=e.add.image(r*.75,o/2,"background2").setOrigin(.5).setScale(1).setDisplaySize(r*.5,o).setDepth(9),A=e.add.image(r*.75,o/2,"PosterReward").setOrigin(.5).setDisplaySize(516,516).setDepth(10),B=R(e,m,C+P/2,a,i,{spacing:o*.012,depth:1301});C+=P+b;const F=e.add.container(0,0).setDepth(1301).setAlpha(1);if(t.length===1){const k=W.create(e,m,C+u/2,t[0],d,u);F.add(k)}else{const k=d*h+w*(h-1);t.forEach((H,G)=>{const Y=G%h,$=Math.floor(G/h),q=m-k/2+Y*(d+w)+d/2,J=C+$*(u+w)+u/2,Q=W.create(e,q,J,H,d,u);F.add(Q)})}C+=y+z;const X=n?"End":"Next",M=e.add.image(m,C+D/2,X).setOrigin(.5).setDisplaySize(x,D).setDepth(1301).setAlpha(1).setScale(1).setInteractive({useHandCursor:!0}),O=[_,I,A,B,F,M];return F.iterate(k=>O.push(k)),M.on("pointerdown",()=>{O.forEach(k=>k.destroy()),F.removeAll(!0),s&&s()}),O}}class we{static create(e,t,s,a,i){return e.add.image(t,s,"Disable_card").setDisplaySize(a,i).setOrigin(.5).setAlpha(.6).setDepth(22)}}const E=["អបអរសាទរអ្នកឈ្នះរង្វាន់","អបអរសាទរអ្នកឈ្នះរង្វាន់","អបអរសាទរអ្នកឈ្នះរង្វាន់"],Se=["វគ្គទី ១: ស្វែងរកអ្នកឈ្នះរង្វាន់","វគ្គទី ២: ស្វែងរកអ្នកឈ្នះរង្វាន់ ","វគ្គទី ៣: ស្វែងរកអ្នកឈ្នះរង្វាន់ "],L=[["កាបូប Sakkin ចំនួន ២៤នាក់"],["ការញ្ញំា ស្តេចចាហួយសុខភាពរយៈពេល ១ឆ្នាំ (១២ប្រអប់)"],["Iphone 16 Pro Max ចំនួន 1 នាក់"]];class ye{constructor(e){p(this,"scene");p(this,"startButton");p(this,"background1");p(this,"background2");p(this,"gamescreen");p(this,"prizenet");p(this,"prizenetopen");p(this,"people");p(this,"thumbnail");p(this,"thumbnailTitle");p(this,"curtainOpen");p(this,"curtainLeft");p(this,"curtainRight");p(this,"transitionOverlay");p(this,"collectedPrizeGraphics",[]);p(this,"stageWinners",[]);p(this,"stagePrizeGraphics",[]);p(this,"isStartButtonDisabled",!1);p(this,"isNetOpen",!1);p(this,"isNetSliding",!1);p(this,"onStart");p(this,"onPopupClosed");this.scene=e}preload(){[["background1","assets/images/poster_thumbnail.png"],["background2","assets/images/streaming_background.png"],["Thumbnail","assets/images/thumbnail.png"],["Poster","assets/images/poster.png"],["PosterReward","assets/images/poster_reward.png"],["PosterTitle","assets/images/poster_title.png"],["Pause","assets/images/game_pause.png"],["Gamescreen","assets/images/lucky_game_main_bg.png"],["winner_blur_bg","assets/images/Blur3.png"],["Ball","assets/images/ticket_prize.png"],["Congrat","assets/images/popup_winner_screen.png"],["card_bg","assets/images/display_winner.png"],["Disable_card","assets/images/disable_card.png"],["Prize_card","assets/images/price_cardbg.png"],["Displayprize","assets/images/display_prize.png"],["People","assets/images/people.png"],["Start","assets/images/start_button.png"],["Next","assets/images/next_button.png"],["End","assets/images/end_button.png"],["BackMenu","assets/images/back_to_menu.png"],["Prize","assets/images/prizes/prize7.png"],["Prize2","assets/images/prizes/prize6.png"],["Prize3","assets/images/prizes/prize8.png"],["Stage1","assets/images/stage1.png"],["Stage2","assets/images/stage2.png"],["Stage3","assets/images/stage3.png"],["stage_label_iphone","assets/images/stage_label_iphone.png"],["stage_label_aojiru","assets/images/stage_label_aojiro.png"],["stage_label_giftbox","assets/images/stage_label_giftbox.png"],["DragText","assets/images/drag_text.png"],["Curtain_left","assets/motions/curtain_left.png"],["Curtain_right","assets/motions/curtain_right.png"],["Curtainopen","assets/motions/curtain_open.png"],["lightshow1","assets/motions/light_show1.png"],["lightshow2","assets/motions/light_show2.png"],["lightshow3","assets/motions/light_show3.png"],["lightshow4","assets/motions/light_show4.png"],["Drag1","assets/motions/drag1.png"],["Drag2","assets/motions/drag2.png"],["Drag3","assets/motions/drag3.png"],["Prizenet","assets/motions/net_close.png"],["Prizenetopen","assets/motions/net_open.png"]].forEach(([t,s])=>this.scene.load.image(t,s))}reset(){this.stageWinners=[]}createLayout(e,t){const s=this.scene.scale.width,a=this.scene.scale.height;this.background1=this.scene.add.image(s*.25,a/2,"winner_blur_bg").setOrigin(.5).setScale(1).setDisplaySize(s*.5,a).setDepth(-1),this.background2=this.scene.add.image(s*.75,a/2,"background2").setOrigin(.5).setScale(1).setDisplaySize(s*.5,a).setDepth(9),this.curtainLeft=this.scene.add.image(0,a/2,"Curtain_left").setOrigin(1,.5).setDisplaySize(s*.25,a).setDepth(2).setAlpha(1).setVisible(!1),this.curtainRight=this.scene.add.image(s/2,a/2,"Curtain_right").setOrigin(0,.5).setDisplaySize(s*.29,a).setDepth(2).setAlpha(1).setVisible(!1),this.thumbnail=this.scene.add.image(s*.25,a/2+148,"PosterReward").setOrigin(.5).setDisplaySize(516,516).setDepth(1),this.thumbnailTitle=this.scene.add.image(s*.25,148+155/2,"PosterTitle").setOrigin(.5).setDisplaySize(369,155).setDepth(1),this.startButton=this.scene.add.image(s*.25,a*.94,"Start").setOrigin(.5).setDisplaySize(s*.1,a*.08).setDepth(1).setScale(1).setInteractive({useHandCursor:!1}),this.isStartButtonDisabled=!1,this.startButton.on("pointerdown",()=>{this.isStartButtonDisabled||(this.isStartButtonDisabled=!0,this.startButton.disableInteractive(),this.onStart&&this.onStart())}),this.gamescreen=null,this.prizenet=null,this.people=null,this.transitionOverlay=this.scene.add.rectangle(s/2,a/2,s,a,0,1).setDepth(100).setAlpha(0)}closeCurtain(e){V.close(this.scene,this.curtainLeft,this.curtainRight,e)}openCurtain(e){V.open(this.scene,this.curtainLeft,this.curtainRight,e)}runWithCurtain(e,t=0){this.closeCurtain(()=>{e(),t>0?setTimeout(()=>this.openCurtain(),t):this.openCurtain()})}slideOutPeople(e){this.people&&this.people.visible?this.scene.tweens.add({targets:this.people,y:this.scene.scale.height*1.2,duration:420,ease:"Cubic.easeIn",onComplete:()=>{var t;(t=this.people)==null||t.setVisible(!1),e&&e()}}):e&&e()}showGameScreen(e){var a;const t=this.scene.scale.width,s=this.scene.scale.height;(a=this.transitionOverlay)==null||a.setAlpha(0),this.curtainLeft.setX(t*.25).setVisible(!0).setAlpha(1),this.curtainRight.setX(t*.25).setVisible(!0).setAlpha(1),me.start(this.scene,t*.257,s*.07,{size:t*.18,depth:5}),this.scene.tweens.add({targets:[this.curtainLeft,this.curtainRight],alpha:1,duration:0,onComplete:()=>{this.closeCurtain(()=>{var i;this.background1.setVisible(!1),this.startButton.setVisible(!1),this.thumbnail.setVisible(!1),this.gamescreen=this.scene.add.image(t*.25,s/2,"Gamescreen").setOrigin(.5).setDisplaySize(t*.5,s).setAlpha(1).setDepth(2),this.people=this.scene.add.image(t*.25,s*1.17,"People").setOrigin(.5).setDisplaySize(t*.6,s*.29).setAlpha(1).setDepth(8).setVisible(!0),this.scene.tweens.add({targets:this.people,y:s*.94,duration:520,ease:"Cubic.easeOut"}),this.prizenet=this.scene.add.image(t*.25,s*.21,"Prizenet").setOrigin(.5).setDisplaySize(t*.5,s*.49).setAlpha(1).setDepth(4),this.prizenetopen=this.scene.add.image(t*.25,s*.21,"Prizenetopen").setOrigin(.5).setDisplaySize(t*.5,s*.49).setAlpha(0).setDepth(3),(i=this.transitionOverlay)==null||i.setAlpha(0),ue.create(this.scene,t*.25,s*.018,{size:t*.007,depth:6,onDrop:e,onDragProgress:n=>{!this.prizenet||!this.prizenetopen||(n>.65&&!this.isNetOpen&&!this.isNetSliding?(this.isNetSliding=!0,this.scene.tweens.add({targets:this.prizenet,y:s*.02,alpha:0,duration:350,ease:"Cubic.easeIn"}),this.scene.tweens.add({targets:this.prizenetopen,alpha:1,duration:350,ease:"Cubic.easeIn",onComplete:()=>{this.isNetOpen=!0,this.isNetSliding=!1}})):n<=.65&&this.isNetOpen&&!this.isNetSliding&&(this.isNetSliding=!0,this.scene.tweens.add({targets:this.prizenet,y:s*.02,alpha:1,duration:350,ease:"Cubic.easeOut"}),this.scene.tweens.add({targets:this.prizenetopen,alpha:0,duration:350,ease:"Cubic.easeOut",onComplete:()=>{this.isNetOpen=!1,this.isNetSliding=!1}})))}}),this.openCurtain()})}})}showStagePrize(e){this.stagePrizeGraphics.forEach(s=>s.destroy()),this.stagePrizeGraphics=[];const t=he.create(this.scene,this.background2,e);this.stagePrizeGraphics.push(...t)}showStageWinnersPanel(e,t){this.stagePrizeGraphics.forEach(r=>r.destroy());const s=this.stageWinners.length,a=E[s]||"",i=L[s]||[],n=s===E.length-1;this.stagePrizeGraphics=fe.show(this.scene,e,()=>{this.stagePrizeGraphics.forEach(r=>r.destroy()),this.stagePrizeGraphics=[],t()},a,i,n),this.stageWinners.push([...e])}showPrizeCongratulation(e,t){N.showCongrat(this.scene,e,()=>{this.onPopupClosed&&this.onPopupClosed(),t&&t()})}showStageLabel(e){const t=this.scene.scale.width,s=this.scene.scale.height,a=Se[e]||"",i=L[e]||[],n=["#FFF7D5","#FFFFFF","#FDF5DB"],r=[{text:a,fontSize:28,fontStyle:"bold",fontFamily:"Kantumruy Pro",stroke:"#765934",strokeThickness:2,shadow:{offsetX:1,offsetY:2,color:"#765934",blur:0,stroke:!0,fill:!0},gradientColors:n}],o=R(this.scene,t*.25,s*.42,r,i,{width:t*.22,spacing:s*.005,titleFontSize:28,subtitleFontSize:16,gradientColors:n,depth:200});this.scene.tweens.add({targets:o,alpha:0,delay:1200,duration:400,onComplete:()=>o.destroy()})}showStageComplete(e){N.showTextOverlay(this.scene,"STAGE COMPLETE!","#00ffae",e,!1)}showGameComplete(){this.showGameCompleteSummary()}showGameCompleteSummary(){const e=this.scene.scale.width,t=this.scene.scale.height,s=e*.25,a=t/2,i=e*.5,n=t;this.scene.add.image(s,a,"winner_blur_bg").setOrigin(.5).setDisplaySize(i,n).setDepth(1500).setAlpha(1),this.scene.add.image(e*.75,t/2,"background2").setOrigin(.5).setScale(1).setDisplaySize(e*.5,t).setDepth(9),this.scene.add.image(e*.75,t/2,"PosterReward").setOrigin(.5).setDisplaySize(516,516).setDepth(10);const r=t*.086,o=t*.014,m=t*.035,c=e*.11,f=t*.058,g=e*.007,h=t*.01,d=4;let u=t*.034;[...this.stageWinners].reverse().forEach((x,S)=>{const y=this.stageWinners.length-1-S,v=E[y]||"",C=L[y]||[],_=[{text:v,fontSize:28,fontStyle:"bold",fontFamily:"Kantumruy Pro",stroke:"#765934",strokeThickness:2,shadow:{offsetX:1,offsetY:2,color:"#765934",blur:0,stroke:!0,fill:!0}}],I=R(this.scene,s,u+r/2-10,_,C,{width:i*.9,spacing:t*.01,titleFontSize:28,subtitleFontSize:18,gradientColors:["#FFF7D5","#FFFFFF","#FDF5DB"],depth:1502});u+=I.height+o;const A=[...x].reverse(),B=A.length;if(B===1)W.create(this.scene,s,u+f/2,A[0],c,f).setDepth(1502),u+=f;else if(B>1){const F=Math.ceil(B/d),X=F*f+(F-1)*h,M=d*c+(d-1)*g;for(let O=0;O<B;O++){const k=O%d,H=Math.floor(O/d),G=s-M/2+k*(c+g)+c/2,Y=u+H*(f+h)+f/2;W.create(this.scene,G,Y,A[O],c,f).setDepth(1502)}u+=X}u+=m});const P=this.scene.add.rectangle(0,0,e,t,0).setOrigin(0).setAlpha(0).setDepth(2e3),b=e*.06,z=t*.06;this.scene.add.image(b/2+e*.015,z/2+t*.025,"BackMenu").setOrigin(.5).setDisplaySize(b,z).setDepth(1503).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{this.scene.tweens.add({targets:P,alpha:1,duration:500,onComplete:()=>{this.scene.scene.restart()}})})}renderPrizePanel(e,t){this.collectedPrizeGraphics.forEach(h=>h.destroy()),this.collectedPrizeGraphics=[];const s=this.scene.scale.width,a=this.scene.scale.height,i=4,n=s*.11,r=72,o=s*.0075,m=n+o,c=r+o,f=s*.574,g=a*.32;for(let h=0;h<t;h++){const d=h%i,u=Math.floor(h/i),w=f+d*m,P=g+u*c,b=e[h],z=b?W.create(this.scene,w,P,b,n,r):we.create(this.scene,w,P,n,r);this.collectedPrizeGraphics.push(z)}}}const j="v2";class be{constructor(e,t,s){p(this,"model");p(this,"view");p(this,"scene");p(this,"isCollectingPrize",!1);p(this,"allWinners",[]);p(this,"stages",[{count:24,label:"Stage 1: ចាប់យកឲបាន 24 Ticket",winner:"អ្នកឈ្នះរង្វាន់"},{count:12,label:"Stage 2: ចាប់យកឲបាន 12 Ticket",winner:"អ្នកឈ្នះរង្វាន់"},{count:1,label:"Final Stage: ចាប់យកឲបាន 1 Ticket",winner:"អ្នកឈ្នះរង្វាន់"}]);p(this,"stagePrizes",[{image:"Prize",name:"Gift Yellow Box",value:"24 ​​រង្វាន់"},{image:"Prize2",name:"Sakkin Aojiru Box",value:"12 ​រង្វាន់"},{image:"Prize3",name:"IPHONE 16 PRO MAX",value:"1 ​​រង្វាន់"}]);p(this,"currentStage",0);p(this,"maxCollect",0);p(this,"ballPairs",[]);p(this,"ballSpawnTimer");p(this,"stageWinners",[]);this.model=e,this.view=t,this.scene=s,this.view.onStart=()=>this.onStartGame(),this.view.onPopupClosed=()=>{this.isCollectingPrize=!1,this.resumeAllBalls()}}async preloadAllWinners(){try{const e=await fetch("data/tickets.json");if(!e.ok)throw new Error("Failed to load ticket data");const s=(await e.json()).map(a=>({name:a.name,phone:String(a.phone),ticket:a.ticket}));this.model.setPreloadedWinners(s),console.log("✅ Top ticket winners loaded",s)}catch(e){console.error("❌ Failed to load top ticket winners",e)}}hasSavedGame(){return!!localStorage.getItem("luckyDrawState")}saveGameState(){const e={version:j,currentStage:this.currentStage,prizes:this.model.getPrizes(),stageWinners:this.stageWinners};localStorage.setItem("luckyDrawState",JSON.stringify(e))}loadGameState(){try{const e=localStorage.getItem("luckyDrawState");if(!e)return;const t=JSON.parse(e);if(t.version!==j){this.clearGameState();return}this.currentStage=t.currentStage??0,this.stageWinners=t.stageWinners??[],this.model.setPrizes(t.prizes??[])}catch(e){console.error("Failed to load saved state",e)}}clearGameState(){localStorage.removeItem("luckyDrawState")}async onStartGame(){await this.preloadAllWinners(),this.allWinners=this.model.getPreloadedWinners(),this.hasSavedGame()?N.showConfirm(this.scene,"Do want to continue the previous game?","Resume","Restart",()=>{if(this.loadGameState(),this.view.reset(),this.stageWinners.forEach(e=>this.view.showStageWinnersPanel(e,()=>{})),this.currentStage>=this.stages.length)this.view.showGameCompleteSummary();else{const e=this.stages[this.currentStage].count;this.view.renderPrizePanel(this.model.getPrizes(),e)}this.curtainStageTransition(()=>this.startStage(this.currentStage))},()=>{this.clearGameState(),this.currentStage=0,this.stageWinners=[],this.curtainStageTransition(()=>this.startStage(0))}):(this.clearGameState(),this.currentStage=0,this.stageWinners=[],this.curtainStageTransition(()=>this.startStage(0)))}startStage(e){var s,a;this.clearAllBalls(),this.model.getPrizes().length===0&&this.model.clearPrizes();const t=this.stages[this.currentStage].count;this.view.renderPrizePanel(this.model.getPrizes(),t),this.maxCollect=this.stages[e].count,(a=(s=this.view).showStageLabel)==null||a.call(s,e),this.view.showGameScreen(()=>this.startInfiniteBallDrop()),this.view.showStagePrize(this.stagePrizes[e])}async fetchRandomPrizeInfo(){const e=new Set(this.model.getPrizes().map(i=>i.phone)),t=this.allWinners.filter(i=>!e.has(i.phone));if(t.length===0)throw new Error("No available winners left");const s=Math.floor(Math.random()*t.length),a=t[s];return this.allWinners=this.allWinners.filter(i=>i.phone!==a.phone),console.log("✅ Simulated winner submission:",{name:a.name,phone:a.phone,stage:this.currentStage+1}),a}startInfiniteBallDrop(){this.ballSpawnTimer&&this.ballSpawnTimer.remove(!1),this.ballSpawnTimer=this.scene.time.addEvent({delay:300,loop:!0,callback:()=>{var e;if(this.model.getPrizes().length>=this.maxCollect){(e=this.ballSpawnTimer)==null||e.remove(!1);return}this.spawnBall()}})}spawnBall(){const{width:e,height:t}=this.scene.scale,s=Phaser.Math.Between(e*.015,e*.47),a=t*.16,i=Math.max(e,t)*.07,n=this.scene.add.image(s,a,"Ball").setOrigin(.5).setDisplaySize(i,i).setDepth(2).setInteractive({useHandCursor:!0});n.setAngle(Phaser.Math.Between(-45,45));const r=this.scene.tweens.add({targets:n,y:t*.98,angle:Phaser.Math.Between(-270,270),ease:"Sine.easeInOut",duration:Phaser.Math.Between(8500,15e3),delay:Phaser.Math.Between(0,700),onComplete:()=>{this.ballPairs=this.ballPairs.filter(o=>o.ball!==n),n.active&&n.destroy()}});this.ballPairs.push({ball:n,tween:r}),n.on("pointerdown",async()=>{if(!(this.isCollectingPrize||this.model.getPrizes().length>=this.maxCollect)){this.isCollectingPrize=!0,n.disableInteractive();try{const o=await this.fetchRandomPrizeInfo();this.collectPrizeWithAnimation(n,o)}catch(o){n.setInteractive({useHandCursor:!0}),this.isCollectingPrize=!1,console.error("Prize fetch failed",o)}}})}collectPrizeWithAnimation(e,t){const{width:s,height:a}=this.scene.scale;this.pauseAllBalls(),this.view.showPrizeCongratulation(t);const i=this.model.getPrizes().length,n=i%3,r=Math.floor(i/3),o=s*.14,m=a*.063,c=s*.007,f=s*.6+n*(o+c),g=a*.32+r*(m+c),h=this.scene.add.image(e.x,e.y,"Ball").setOrigin(.5).setDisplaySize(m,m).setDepth(100);this.scene.tweens.add({targets:h,x:f,y:g,scale:1.3,alpha:.6,duration:700,ease:"Cubic.easeIn",onComplete:()=>{h.destroy(),this.model.addPrize(t);const d=this.stages[this.currentStage].count;this.view.renderPrizePanel(this.model.getPrizes(),d),this.saveGameState(),this.model.getPrizes().length>=this.maxCollect&&this.onStageComplete()}}),this.scene.tweens.add({targets:e,scale:1.4,alpha:0,duration:200,onComplete:()=>{e.destroy(),this.ballPairs=this.ballPairs.filter(d=>d.ball!==e)}})}pauseAllBalls(){this.ballPairs.forEach(e=>{e.ball.active&&e.tween&&!e.tween.paused&&(e.tween.pause(),e.ball.disableInteractive())}),this.ballSpawnTimer&&(this.ballSpawnTimer.paused=!0)}resumeAllBalls(){this.ballPairs.forEach(e=>{e.ball.active&&e.tween&&e.tween.paused&&(e.tween.resume(),e.ball.setInteractive({useHandCursor:!0}))}),this.ballSpawnTimer&&(this.ballSpawnTimer.paused=!1)}onStageComplete(){this.clearAllBalls();const e=this.model.getPrizes();this.view.collectedPrizeGraphics.forEach(t=>t.destroy()),this.view.collectedPrizeGraphics=[],this.view.slideOutPeople(()=>{this.view.showStageWinnersPanel(e,()=>{this.stageWinners.push([...e]),this.currentStage++,this.currentStage<this.stages.length?(this.model.clearPrizes(),this.saveGameState(),this.curtainStageTransition(()=>this.startStage(this.currentStage))):(this.clearGameState(),this.curtainStageTransition(()=>{var t,s;(s=(t=this.view).showGameComplete)==null||s.call(t)}))})})}clearAllBalls(){this.ballPairs.forEach(e=>{var t,s;(t=e.tween)!=null&&t.isPlaying()&&e.tween.stop(),(s=e.ball)!=null&&s.active&&e.ball.destroy()}),this.ballPairs=[],this.ballSpawnTimer&&(this.ballSpawnTimer.remove(!1),this.ballSpawnTimer=void 0)}curtainStageTransition(e){this.view.closeCurtain(()=>{e(),this.view.openCurtain()})}}class Pe extends T.Scene{constructor(){super({key:"LuckyDrawScene"});p(this,"model");p(this,"view")}preload(){this.model=new ne,this.view=new ye(this),this.view.preload()}create(){const t=this.cameras.main.centerX,s=this.cameras.main.centerY;this.view.createLayout(t,s),this.view.createLayout(t,s),new be(this.model,this.view,this)}}const ze={type:T.AUTO,width:1920,height:1080,backgroundColor:"#538b3c",scene:[ie,Pe],parent:"game",scale:{mode:T.Scale.FIT,autoCenter:T.Scale.CENTER_BOTH,width:1920,height:1080}};new T.Game(ze);
