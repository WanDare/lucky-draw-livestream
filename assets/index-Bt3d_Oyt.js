var Q=Object.defineProperty;var Z=(d,e,t)=>e in d?Q(d,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[e]=t;var g=(d,e,t)=>Z(d,typeof e!="symbol"?e+"":e,t);import{r as ee,g as te}from"./phaser-CNtu8dn9.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(a){if(a.ep)return;a.ep=!0;const n=t(a);fetch(a.href,n)}})();var se=ee();const F=te(se);class ae extends F.Scene{constructor(){super({key:"LoadingScene"});g(this,"progressBar");g(this,"progressBox");g(this,"loadingText");g(this,"percentText")}preload(){const{width:t,height:s}=this.cameras.main;this.progressBox=this.add.graphics(),this.progressBox.fillStyle(2236962,.8),this.progressBox.fillRect(t/2-170,s/2-30,340,60),this.progressBar=this.add.graphics(),this.loadingText=this.make.text({x:t/2,y:s/2-50,text:"Loading...",style:{font:"bold 28px Arial",color:"#ffffff",align:"center"}}).setOrigin(.5),this.percentText=this.make.text({x:t/2,y:s/2,text:"0%",style:{font:"24px Arial",color:"#ffffff",align:"center",shadow:{offsetX:1,offsetY:1,color:"#000000",blur:2,stroke:!1,fill:!0}}}).setOrigin(.5);for(let r=0;r<30;r++)this.load.image(`dummy${r}`,"assets/images/ticket_prize.png");this.load.on("progress",r=>{this.progressBar.clear(),this.progressBar.fillStyle(227626,1),this.progressBar.fillRect(t/2-160,s/2-15,320*r,30),this.percentText.setText(`${Math.floor(r*100)}%`)});let a=!1,n=!1;this.load.on("complete",()=>{a=!0,i.call(this)}),this.time.delayedCall(1500,()=>{n=!0,i.call(this)});const i=()=>{a&&n&&(this.progressBar.destroy(),this.progressBox.destroy(),this.loadingText.destroy(),this.percentText.destroy(),this.scene.start("LuckyDrawScene"))}}}class ie{constructor(){g(this,"collected",[])}addPrize(e){this.collected.push(e)}getPrizes(){return[...this.collected]}clearPrizes(){this.collected=[]}setPrizes(e){this.collected=[...e]}}function ne(d){const e=d.replace(/\D/g,"");if(e.length<11)return d;const t=e.slice(0,3),s=e.slice(3,5),a=e.slice(-2);return`${t} ${s}XXXXXX${a}`}class W{static create(e,t,s,a,n=209,i=65){const m=e.add.image(0,0,"card_bg").setDisplaySize(n,i).setOrigin(.5),c=e.add.text(0,0,a.name.toUpperCase(),{font:"14px Poppins",color:"#ffffff",align:"center",fontStyle:"400",fontFamily:"Poppins",letterSpacing:-.24,wordWrap:{width:n-2*12,useAdvancedWrap:!0}}).setOrigin(.5,0),l=e.add.text(0,0,ne(a.phone),{font:"18px Poppins",color:"#ffffff",align:"center",fontStyle:"600",letterSpacing:-.4,wordWrap:{width:n-2*12,useAdvancedWrap:!0}}).setOrigin(.5,0),p=c.height+8+l.height;c.y=-p/2,l.y=c.y+c.height+8;const w=e.add.container(t,s,[m,c,l]);return w.setDepth(22),w.setScale(.7).setAlpha(0),e.tweens.add({targets:w,alpha:1,scale:1,duration:200,ease:"Back.Out"}),w}}class re{static create(e,t,s){const a=t.x,n=t.y-t.displayHeight/2+30,i=e.add.image(a,n+143,"Displayprize").setOrigin(.5,0).setDisplaySize(270,80).setAlpha(0).setDepth(t.depth+1),r=e.add.image(a,220,s.image).setOrigin(.5,0).setDisplaySize(154,161).setAlpha(0).setDepth(t.depth+2),o=175,u=64,h=n+190,m=e.add.image(0,0,"Prize_card").setDisplaySize(o,u).setOrigin(.5),c=e.add.text(0,0,s.name.toUpperCase(),{fontSize:16,fontFamily:"Poppins",fontStyle:"bold",color:"#ffffff",align:"center",letterSpacing:-.32,wordWrap:{width:o-16,useAdvancedWrap:!0}}).setOrigin(.5,0),l=e.add.text(0,0,s.value.toUpperCase(),{font:"bold 16px Poppins",color:"#ffffff",align:"center",fontStyle:"bold",fontSize:"24px",wordWrap:{width:o-16,useAdvancedWrap:!0}}).setOrigin(.5),p=15,w=c.height+l.height+p;c.y=-w/2+3,l.y=c.y+c.height+p;const S=e.add.container(a,h,[m,c,l]);return S.setDepth(t.depth+4),S.setScale(.7).setAlpha(0),e.tweens.add({targets:i,alpha:1,duration:350,ease:"Back.Out"}),e.tweens.add({targets:r,alpha:1,y:n,duration:360,delay:100,ease:"Back.Out"}),e.tweens.add({targets:S,alpha:1,scale:1,duration:350,delay:180,ease:"Back.Out"}),[i,r,S]}}class U{static close(e,t,s,a){const n=e.scale.width;t.setX(0).setVisible(!0).setAlpha(1).setDepth(7),s.setX(n*.5).setVisible(!0).setAlpha(1).setDepth(7),e.tweens.add({targets:t,x:n*.25,duration:1500,ease:"Cubic.easeInOut"}),e.tweens.add({targets:s,x:n*.215,duration:1500,ease:"Cubic.easeInOut",onComplete:()=>{a&&a()}})}static open(e,t,s,a){const n=e.scale.width;t.setX(n*.25).setVisible(!0).setAlpha(1).setDepth(7),s.setX(n*.215).setVisible(!0).setAlpha(1).setDepth(7);let i=0;function r(){i+=1,i===2&&(t.setVisible(!1),s.setVisible(!1),a&&a())}e.tweens.add({targets:t,x:0,duration:1500,ease:"Cubic.easeInOut",onComplete:r}),e.tweens.add({targets:s,x:n*.5,duration:1500,ease:"Cubic.easeInOut",onComplete:r})}}function j(d,e){const t=(e==null?void 0:e.x)??720,s=(e==null?void 0:e.y)??512,a=(e==null?void 0:e.amount)??64,n=[16771899,15277667,5025616,240116,16750592,10233776,16777215];for(let i=0;i<a;i++){const r=Phaser.Math.FloatBetween(-120,-60),o=Phaser.Math.Between(400,900),u=Math.cos(Phaser.Math.DegToRad(r))*o,h=Math.sin(Phaser.Math.DegToRad(r))*o,m=n[Phaser.Math.Between(0,n.length-1)],c=Phaser.Math.Between(12,22),l=d.add.rectangle(t,s,c,c/3,m).setRotation(Phaser.Math.FloatBetween(0,Math.PI*2)).setAlpha(.85).setDepth(999);d.tweens.add({targets:l,x:t+u*1.2,y:s+h*1+Phaser.Math.Between(200,420),angle:Phaser.Math.Between(0,360),rotation:Phaser.Math.FloatBetween(0,Math.PI*4),alpha:.25,scaleX:Phaser.Math.FloatBetween(.7,1.3),scaleY:Phaser.Math.FloatBetween(.6,1.5),duration:Phaser.Math.Between(900,1500),ease:"Cubic.easeOut",onComplete:()=>l.destroy()})}}function oe(d){const e=d.replace(/\D/g,"");if(e.length<11)return d;const t=e.slice(0,5),s="XXXXXX",a=e.slice(-2);return`${t}${s}${a}`}class N{static showCongrat(e,t,s){const{width:a,height:n}=e.scale,i=e.add.rectangle(a/2,n/2,a,n,0,.48).setDepth(300).setAlpha(0),r=e.add.image(a/2,n/2,"Congrat").setOrigin(.5).setDisplaySize(a,n).setDepth(2e3).setAlpha(0),o=Math.max(18),u=Math.max(28),h=e.add.text(a/2+50,n*.525,t.name.toUpperCase(),{font:`${o}px Arial`,color:"#538B3C",align:"center",fontStyle:"normal",letterSpacing:-.32}).setOrigin(.5).setDepth(2001).setAlpha(0),m=e.add.text(a/2+50,n*.555,oe(t.phone.toUpperCase()),{font:`bold ${u}px Arial`,color:"#538B3C",align:"center",letterSpacing:-.48}).setOrigin(.5).setDepth(2001).setAlpha(0);e.tweens.add({targets:[i,r,h,m],alpha:1,duration:300,ease:"Quad.easeOut",onComplete:()=>{let c=!1;const l=()=>{c||(c=!0,e.tweens.add({targets:[i,r,h,m],alpha:0,duration:350,onComplete:()=>{i.destroy(),r.destroy(),h.destroy(),m.destroy(),s&&s()}}))};i.setInteractive({useHandCursor:!0}),r.setInteractive({useHandCursor:!0}),i.once("pointerdown",l),r.once("pointerdown",l),e.time.delayedCall(3e3,l)}})}static showTextOverlay(e,t,s,a,n){const{width:i,height:r}=e.scale,o=e.add.rectangle(i/2,r/2,i,r,0,.7).setDepth(250).setAlpha(0),u=Math.max(32,r*.053),h=e.add.text(i/2,r/2,t,{font:`bold ${u}px Arial`,color:s,align:"center"}).setOrigin(.5).setDepth(251).setAlpha(0);e.tweens.add({targets:[o,h],alpha:1,duration:350,ease:"Quad.easeIn",onComplete:()=>{n&&(j(e,{x:i/2,y:r/2,amount:70}),e.time.delayedCall(600,()=>{j(e,{x:i/2,y:r/2-r*.1,amount:48})})),e.time.delayedCall(1e3,()=>{e.tweens.add({targets:[o,h],alpha:0,duration:350,onComplete:()=>{o.destroy(),h.destroy(),a&&a()}})})}})}static showConfirm(e,t,s,a,n,i){const{width:r,height:o}=e.scale,u=e.add.rectangle(r/2,o/2,r,o,0,.5).setDepth(900),h=e.add.image(r/2,o/2,"Pause").setOrigin(.5).setScale(1).setDisplaySize(r*.4,o*.25).setDepth(901),m=e.add.text(r/2,o/2-40,t,{font:`bold ${Math.max(24,o*.03)}px Arial`,color:"#ffffff",align:"center",wordWrap:{width:r*.5}}).setOrigin(.5).setDepth(902),c=128,l=48,p=(D,P,C,x,f)=>{const y=e.add.graphics();y.fillStyle(C,1),y.fillRoundedRect(-128/2,-48/2,c,l,12);const z=e.add.text(0,0,x,{font:"20px Arial",color:"#ffffff",align:"center"}).setOrigin(.5),B=e.add.zone(0,0,c,l).setOrigin(.5).setInteractive({useHandCursor:!0}),_=e.add.container(D,P,[y,z,B]).setDepth(902);return B.on("pointerdown",()=>{b(),f()}),_},w=p(r/2-100,o/2+40,43622,s,n),S=p(r/2+100,o/2+40,11141120,a,i),b=()=>{u.destroy(),h.destroy(),m.destroy(),w.destroy(),S.destroy()}}}function le(d,e,t,s,a){const n=d.textures.createCanvas(e,t,s);if(!n)throw new Error("Failed to create canvas texture.");const i=n.getContext(),r=i.createLinearGradient(0,0,t,0);return a.length>1?(r.addColorStop(0,a[0]),r.addColorStop(.5,a[1]),a.length>2&&r.addColorStop(1,a[2])):a.length===1&&(r.addColorStop(0,a[0]),r.addColorStop(1,a[0])),i.fillStyle=r,i.fillRect(0,0,t,s),n.refresh(),n}function J(d,e,t,s,a,n,i,r,o,u={},h=8){const m=d.add.text(0,0,s.toUpperCase(),{fontFamily:i,fontSize:`${a}px`,fontStyle:r,align:"center",color:"#fff",lineSpacing:h,wordWrap:{width:n,useAdvancedWrap:!0},...u}).setOrigin(.5,.5),c=`gradient-${F.Math.RND.uuid()}`;le(d,c,n,m.height,o);const l=d.add.image(0,0,c).setOrigin(.5,.5);l.setMask(m.createBitmapMask());const p=d.add.container(e,t,[l,m]);return p.setSize(n,m.height),p.on("destroy",()=>{d.textures.exists(c)&&d.textures.remove(c)}),p}function $(d,e,t,s,a,n={}){const{spacing:i=10,depth:r=1502,titleFontSize:o=34,subtitleFontSize:u=24,gradientColors:h=["#FFF7D5","#FFFFFF","#FDF5DB"],width:m=380,subtitleStyle:c={fontFamily:"Kantumruy Pro",fontSize:`${u}px`,fontStyle:"normal",align:"center",color:"#FFFFFF",stroke:"#765934",strokeThickness:2,shadow:{offsetX:1,offsetY:2,color:"#765934",blur:0,stroke:!0,fill:!0},lineSpacing:7}}=n;let l;typeof s=="string"?l=[{text:s,fontSize:o,fontFamily:"Kantumruy Pro",fontStyle:"bold",gradientColors:h,stroke:"#765934",strokeThickness:2,shadow:{offsetX:1,offsetY:2,color:"#765934",blur:0,stroke:!0,fill:!0}}]:l=s.map(f=>({fontFamily:f.fontFamily||"Kantumruy Pro",fontSize:f.fontSize||o,fontStyle:f.fontStyle||"normal",gradientColors:f.gradientColors||h,stroke:f.stroke??"#765934",strokeThickness:f.strokeThickness??2,shadow:f.shadow??{offsetX:1,offsetY:2,color:"#765934",blur:0,stroke:!0,fill:!0},...f}));const p=[];let w=0;for(const[f,y]of l.entries()){const z=J(d,0,0,y.text,y.fontSize||o,m,y.fontFamily||"Kantumruy Pro",y.fontStyle||"normal",y.gradientColors||h,{stroke:y.stroke,strokeThickness:y.strokeThickness,shadow:y.shadow},Math.round((y.fontSize||o)*.45));z.y=w,w+=z.height+(f<l.length-1?i:0),p.push(z)}const S=a.map(f=>d.add.text(0,0,f.toUpperCase(),{...c,fontSize:`${u}px`}).setOrigin(.5,0)),b=w,D=S.reduce((f,y)=>f+y.height+i,0)-(a.length>0?i:0),P=b+(a.length>0?i:0)+D;let C=-P/2;for(const f of p)f.y=C+f.height/2,C+=f.height+i;for(const f of S)f.y=C,C+=f.height+i;const x=d.add.container(e,t,[...p,...S]);return x.setDepth(r),x.setSize(m,P),x}class ce{static create(e,t,s,a){const n=["Drag1","Drag2","Drag3"];let i=0;const r=a.depth??5,o=e.add.image(0,0,n[0]).setOrigin(.5,0).setDisplaySize(133,88).setDepth(r).setAlpha(1).setInteractive({draggable:!0,useHandCursor:!0}),u=J(e,0,130,"ចាប់ផ្តើមចាប់សន្លឹកឆ្នោត",34,428,"Kantumruy Pro","bold",["#FFF7D5","#FFFFFF","#FDF5DB"],{stroke:"#765934",strokeThickness:2,shadow:{offsetX:1,offsetY:2,color:"#765934",blur:0,stroke:!0,fill:!0}}),h=e.add.container(t,300,[o,u]).setDepth(r);o.setInteractive({draggable:!0,useHandCursor:!0}),e.input.setDraggable(o);const m=e.time.addEvent({delay:400,loop:!0,callback:()=>{i=(i+1)%n.length,o.setTexture(n[i])}});let c=0,l=!1,p=!1;const w=48;return o.on("dragstart",S=>{c=h.y,l=!1,p=!1}),o.on("drag",(S,b,D)=>{if(l)return;p||(p=!0,e.tweens.add({targets:h,scale:.5,duration:120,yoyo:!0}));const P=c+80;h.y=F.Math.Clamp(D,c,P);const C=F.Math.Clamp((h.y-c)/(P-c),0,1);a.onDragProgress&&a.onDragProgress(C)}),o.on("dragend",S=>{p=!1,!l&&h.y>c+w?(l=!0,e.tweens.add({targets:h,y:c+56,scaleY:.5,duration:120,yoyo:!0,onComplete:()=>{m.remove(!1),h.destroy(),a.onDrop&&a.onDrop()}})):e.tweens.add({targets:h,y:c,scaleY:.5,duration:110})}),h}}class he{static start(e,t,s,a){const n=["lightshow1","lightshow2","lightshow3","lightshow4"];let i=0;const r=(a==null?void 0:a.depth)??12,o=e.add.image(t,s,n[0]).setOrigin(.5).setDisplaySize(1150,250).setDepth(r),u=e.time.addEvent({delay:500,loop:!0,callback:()=>{i=(i+1)%n.length,o.setTexture(n[i])}});function h(){u.remove(!1),o.destroy()}return{image:o,stop:h}}}class de{static show(e,t,s,a,n){const i=e.scale.width,r=e.scale.height,o=i*.25,u=r/2,h=i*.5,m=r,c=4,l=i*.11,p=r*.058,w=i*.01,S=r*.086,b=r*.024,D=r*.032,P=r*.078,C=i*.085,x=t.length===1?1:Math.ceil(t.length/c),f=t.length===1?p:x*p+(x-1)*w,y=S+b+f+D+P;let z=u-y/2;const B=e.add.image(o,u,"winner_blur_bg").setOrigin(.5).setDisplaySize(h,m).setDepth(1299).setAlpha(1),_=i*.75,M=r/2,I=e.add.image(_,M,"Poster").setOrigin(.5).setScale(1).setDisplaySize(h,m).setDepth(1301),G=$(e,o,z+S/2,a,n,{spacing:r*.012,depth:1301});z+=S+b;const v=e.add.container(0,0).setDepth(1301).setAlpha(1);if(t.length===1){const O=W.create(e,o,z+p/2,t[0],l,p);v.add(O)}else{const O=l*c+w*(c-1);t.forEach((X,k)=>{const H=k%c,Y=Math.floor(k/c),L=o-O/2+H*(l+w)+l/2,E=z+Y*(p+w)+p/2,V=W.create(e,L,E,X,l,p);v.add(V)})}z+=f+D;const T=e.add.image(o,z+P/2,"Next").setOrigin(.5).setDisplaySize(C,P).setDepth(1301).setAlpha(1).setScale(1).setInteractive({useHandCursor:!0}),A=[B,I,G,v,T];return v.iterate(O=>A.push(O)),T.on("pointerdown",()=>{A.forEach(O=>O.destroy()),v.removeAll(!0),s&&s()}),A}}class ge{static create(e,t,s,a,n){return e.add.image(t,s,"Disable_card").setDisplaySize(a,n).setOrigin(.5).setAlpha(.6).setDepth(22)}}const K=["អបអរសាទរអ្នកឈ្នះរង្វាន់","អបអរសាទរអ្នកឈ្នះរង្វាន់","អបអរសាទរអ្នកឈ្នះរង្វាន់"],pe=["វគ្គទី ១: ស្វែងរកអ្នកឈ្នះរង្វាន់","វគ្គទី ២: ស្វែងរកអ្នកឈ្នះរង្វាន់ ","វគ្គទី ៣: ស្វែងរកអ្នកឈ្នះរង្វាន់ "],R=[["កាបូប Sakkin ចំនួន ២៤នាក់"],["ការញ្ញំា ស្តេចចាហួយសុខភាពរយៈពេល ១ឆ្នាំ (១២ប្រអប់)"],["Iphone 16 Pro Max ចំនួន 1 នាក់"]];class ue{constructor(e){g(this,"scene");g(this,"startButton");g(this,"background1");g(this,"background2");g(this,"gamescreen");g(this,"prizenet");g(this,"prizenetopen");g(this,"people");g(this,"thumbnail");g(this,"curtainOpen");g(this,"curtainLeft");g(this,"curtainRight");g(this,"transitionOverlay");g(this,"collectedPrizeGraphics",[]);g(this,"stageWinners",[]);g(this,"stagePrizeGraphics",[]);g(this,"isStartButtonDisabled",!1);g(this,"isNetOpen",!1);g(this,"isNetSliding",!1);g(this,"onStart");g(this,"onPopupClosed");this.scene=e}preload(){[["background1","assets/images/poster_thumbnail.png"],["background2","assets/images/streaming_background.png"],["Thumbnail","assets/images/thumbnail.png"],["Poster","assets/images/poster.png"],["Pause","assets/images/game_pause.png"],["Gamescreen","assets/images/lucky_game_main_bg.png"],["winner_blur_bg","assets/images/Blur3.png"],["Ball","assets/images/ticket_prize.png"],["Congrat","assets/images/popup_winner_screen.png"],["card_bg","assets/images/display_winner.png"],["Disable_card","assets/images/disable_card.png"],["Prize_card","assets/images/price_cardbg.png"],["Displayprize","assets/images/display_prize.png"],["People","assets/images/people.png"],["Start","assets/images/start_button.png"],["Next","assets/images/next_button.png"],["BackMenu","assets/images/back_to_menu.png"],["Prize","assets/images/prizes/prize7.png"],["Prize2","assets/images/prizes/prize6.png"],["Prize3","assets/images/prizes/prize8.png"],["Stage1","assets/images/stage1.png"],["Stage2","assets/images/stage2.png"],["Stage3","assets/images/stage3.png"],["stage_label_iphone","assets/images/stage_label_iphone.png"],["stage_label_aojiru","assets/images/stage_label_aojiro.png"],["stage_label_giftbox","assets/images/stage_label_giftbox.png"],["DragText","assets/images/drag_text.png"],["Curtain_left","assets/motions/curtain_left.png"],["Curtain_right","assets/motions/curtain_right.png"],["Curtainopen","assets/motions/curtain_open.png"],["lightshow1","assets/motions/light_show1.png"],["lightshow2","assets/motions/light_show2.png"],["lightshow3","assets/motions/light_show3.png"],["lightshow4","assets/motions/light_show4.png"],["Drag1","assets/motions/drag1.png"],["Drag2","assets/motions/drag2.png"],["Drag3","assets/motions/drag3.png"],["Prizenet","assets/motions/net_close.png"],["Prizenetopen","assets/motions/net_open.png"]].forEach(([t,s])=>this.scene.load.image(t,s))}reset(){this.stageWinners=[]}createLayout(e,t){const s=this.scene.scale.width,a=this.scene.scale.height;this.background1=this.scene.add.image(s*.25,a/2,"background1").setOrigin(.5).setScale(1).setDisplaySize(s*.5,a).setDepth(-1),this.background2=this.scene.add.image(s*.75,a/2,"background2").setOrigin(.5).setScale(1).setDisplaySize(s*.5,a).setDepth(9),this.curtainLeft=this.scene.add.image(0,a/2,"Curtain_left").setOrigin(1,.5).setDisplaySize(s*.25,a).setDepth(2).setAlpha(1).setVisible(!1),this.curtainRight=this.scene.add.image(s/2,a/2,"Curtain_right").setOrigin(0,.5).setDisplaySize(s*.29,a).setDepth(2).setAlpha(1).setVisible(!1),this.thumbnail=this.scene.add.image(s*.25,a/2,"Thumbnail").setOrigin(.5).setDisplaySize(s*.36,a*.71).setDepth(1),this.startButton=this.scene.add.image(s*.25,a*.94,"Start").setOrigin(.5).setDisplaySize(s*.1,a*.08).setDepth(1).setScale(1).setInteractive({useHandCursor:!1}),this.isStartButtonDisabled=!1,this.startButton.on("pointerdown",()=>{this.isStartButtonDisabled||(this.isStartButtonDisabled=!0,this.startButton.disableInteractive(),this.onStart&&this.onStart())}),this.gamescreen=null,this.prizenet=null,this.people=null,this.transitionOverlay=this.scene.add.rectangle(s/2,a/2,s,a,0,1).setDepth(100).setAlpha(0)}closeCurtain(e){U.close(this.scene,this.curtainLeft,this.curtainRight,e)}openCurtain(e){U.open(this.scene,this.curtainLeft,this.curtainRight,e)}runWithCurtain(e,t=0){this.closeCurtain(()=>{e(),t>0?setTimeout(()=>this.openCurtain(),t):this.openCurtain()})}slideOutPeople(e){this.people&&this.people.visible?this.scene.tweens.add({targets:this.people,y:this.scene.scale.height*1.2,duration:420,ease:"Cubic.easeIn",onComplete:()=>{var t;(t=this.people)==null||t.setVisible(!1),e&&e()}}):e&&e()}showGameScreen(e){var a;const t=this.scene.scale.width,s=this.scene.scale.height;(a=this.transitionOverlay)==null||a.setAlpha(0),this.curtainLeft.setX(t*.25).setVisible(!0).setAlpha(1),this.curtainRight.setX(t*.25).setVisible(!0).setAlpha(1),he.start(this.scene,t*.257,s*.07,{size:t*.18,depth:5}),this.scene.tweens.add({targets:[this.curtainLeft,this.curtainRight],alpha:1,duration:0,onComplete:()=>{this.closeCurtain(()=>{var n;this.background1.setVisible(!1),this.startButton.setVisible(!1),this.thumbnail.setVisible(!1),this.gamescreen=this.scene.add.image(t*.25,s/2,"Gamescreen").setOrigin(.5).setDisplaySize(t*.5,s).setAlpha(1).setDepth(2),this.people=this.scene.add.image(t*.25,s*1.17,"People").setOrigin(.5).setDisplaySize(t*.6,s*.29).setAlpha(1).setDepth(8).setVisible(!0),this.scene.tweens.add({targets:this.people,y:s*.94,duration:520,ease:"Cubic.easeOut"}),this.prizenet=this.scene.add.image(t*.25,s*.21,"Prizenet").setOrigin(.5).setDisplaySize(t*.5,s*.49).setAlpha(1).setDepth(4),this.prizenetopen=this.scene.add.image(t*.25,s*.21,"Prizenetopen").setOrigin(.5).setDisplaySize(t*.5,s*.49).setAlpha(0).setDepth(3),(n=this.transitionOverlay)==null||n.setAlpha(0),ce.create(this.scene,t*.25,s*.018,{size:t*.007,depth:6,onDrop:e,onDragProgress:i=>{!this.prizenet||!this.prizenetopen||(i>.65&&!this.isNetOpen&&!this.isNetSliding?(this.isNetSliding=!0,this.scene.tweens.add({targets:this.prizenet,y:s*.02,alpha:0,duration:350,ease:"Cubic.easeIn"}),this.scene.tweens.add({targets:this.prizenetopen,alpha:1,duration:350,ease:"Cubic.easeIn",onComplete:()=>{this.isNetOpen=!0,this.isNetSliding=!1}})):i<=.65&&this.isNetOpen&&!this.isNetSliding&&(this.isNetSliding=!0,this.scene.tweens.add({targets:this.prizenet,y:s*.02,alpha:1,duration:350,ease:"Cubic.easeOut"}),this.scene.tweens.add({targets:this.prizenetopen,alpha:0,duration:350,ease:"Cubic.easeOut",onComplete:()=>{this.isNetOpen=!1,this.isNetSliding=!1}})))}}),this.openCurtain()})}})}showStagePrize(e){this.stagePrizeGraphics.forEach(s=>s.destroy()),this.stagePrizeGraphics=[];const t=re.create(this.scene,this.background2,e);this.stagePrizeGraphics.push(...t)}showStageWinnersPanel(e,t){this.stagePrizeGraphics.forEach(i=>i.destroy());const s=this.stageWinners.length,a=K[s]||"",n=R[s]||[];this.stagePrizeGraphics=de.show(this.scene,e,()=>{this.stagePrizeGraphics.forEach(i=>i.destroy()),this.stagePrizeGraphics=[],t()},a,n),this.stageWinners.push([...e])}showPrizeCongratulation(e,t){N.showCongrat(this.scene,e,()=>{this.onPopupClosed&&this.onPopupClosed(),t&&t()})}showStageLabel(e){const t=this.scene.scale.width,s=this.scene.scale.height,a=pe[e]||"",n=R[e]||[],i=["#FFF7D5","#FFFFFF","#FDF5DB"],r=[{text:a,fontSize:28,fontStyle:"bold",fontFamily:"Kantumruy Pro",stroke:"#765934",strokeThickness:2,shadow:{offsetX:1,offsetY:2,color:"#765934",blur:0,stroke:!0,fill:!0},gradientColors:i}],o=$(this.scene,t*.25,s*.42,r,n,{width:t*.22,spacing:s*.005,titleFontSize:28,subtitleFontSize:16,gradientColors:i,depth:200});this.scene.tweens.add({targets:o,alpha:0,delay:1200,duration:400,onComplete:()=>o.destroy()})}showStageComplete(e){N.showTextOverlay(this.scene,"STAGE COMPLETE!","#00ffae",e,!1)}showGameComplete(){this.showGameCompleteSummary()}showGameCompleteSummary(){const e=this.scene.scale.width,t=this.scene.scale.height,s=e*.25,a=t/2,n=e*.5,i=t;this.scene.add.image(s,a,"winner_blur_bg").setOrigin(.5).setDisplaySize(n,i).setDepth(1500).setAlpha(1);const r=e*.75,o=t/2;this.scene.add.image(r,o,"Poster").setOrigin(.5).setDisplaySize(n,i).setDepth(1501);const u=t*.086,h=t*.014,m=t*.035,c=e*.11,l=t*.058,p=e*.007,w=t*.01,S=4;let b=t*.034;[...this.stageWinners].reverse().forEach((y,z)=>{const B=this.stageWinners.length-1-z,_=K[B]||"",M=R[B]||[],I=[{text:_,fontSize:28,fontStyle:"bold",fontFamily:"Kantumruy Pro",stroke:"#765934",strokeThickness:2,shadow:{offsetX:1,offsetY:2,color:"#765934",blur:0,stroke:!0,fill:!0}}],G=$(this.scene,s,b+u/2-10,I,M,{width:n*.9,spacing:t*.01,titleFontSize:28,subtitleFontSize:18,gradientColors:["#FFF7D5","#FFFFFF","#FDF5DB"],depth:1502});b+=G.height+h;const v=[...y].reverse(),T=v.length;if(T===1)W.create(this.scene,s,b+l/2,v[0],c,l).setDepth(1502),b+=l;else if(T>1){const A=Math.ceil(T/S),O=A*l+(A-1)*w,X=S*c+(S-1)*p;for(let k=0;k<T;k++){const H=k%S,Y=Math.floor(k/S),L=s-X/2+H*(c+p)+c/2,E=b+Y*(l+w)+l/2;W.create(this.scene,L,E,v[k],c,l).setDepth(1502)}b+=O}b+=m});const P=this.scene.add.rectangle(0,0,e,t,0).setOrigin(0).setAlpha(0).setDepth(2e3),C=e*.06,x=t*.06;this.scene.add.image(C/2+e*.015,x/2+t*.025,"BackMenu").setOrigin(.5).setDisplaySize(C,x).setDepth(1503).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{this.scene.tweens.add({targets:P,alpha:1,duration:500,onComplete:()=>{this.scene.scene.restart()}})})}renderPrizePanel(e,t){this.collectedPrizeGraphics.forEach(l=>l.destroy()),this.collectedPrizeGraphics=[];const s=this.scene.scale.width,a=this.scene.scale.height,n=4,i=s*.11,r=a*.058,o=s*.0075,u=i+o,h=r+o,m=s*.574,c=a*.32;for(let l=0;l<t;l++){const p=l%n,w=Math.floor(l/n),S=m+p*u,b=c+w*h,D=e[l],P=D?W.create(this.scene,S,b,D,i,r):ge.create(this.scene,S,b,i,r);this.collectedPrizeGraphics.push(P)}}}const me="https://6854d28b6a6ef0ed663032bd.mockapi.io/api/vi/user",q="v2";class fe{constructor(e,t,s){g(this,"model");g(this,"view");g(this,"scene");g(this,"isCollectingPrize",!1);g(this,"stages",[{count:24,label:"Stage 1: ចាប់យកឲបាន 24 Ticket",winner:"អ្នកឈ្នះរង្វាន់"},{count:12,label:"Stage 2: ចាប់យកឲបាន 12 Ticket",winner:"អ្នកឈ្នះរង្វាន់"},{count:1,label:"Final Stage: ចាប់យកឲបាន 1 Ticket",winner:"អ្នកឈ្នះរង្វាន់"}]);g(this,"stagePrizes",[{image:"Prize",name:"Gift Yellow Box",value:"24 ​​រង្វាន់"},{image:"Prize2",name:"Sakkin Aojiru Box",value:"12 ​រង្វាន់"},{image:"Prize3",name:"IPHONE 16 PRO MAX",value:"1 ​​រង្វាន់"}]);g(this,"currentStage",0);g(this,"maxCollect",0);g(this,"ballPairs",[]);g(this,"ballSpawnTimer");g(this,"stageWinners",[]);this.model=e,this.view=t,this.scene=s,this.view.onStart=()=>this.onStartGame(),this.view.onPopupClosed=()=>{this.isCollectingPrize=!1,this.resumeAllBalls()}}hasSavedGame(){return!!localStorage.getItem("luckyDrawState")}saveGameState(){const e={version:q,currentStage:this.currentStage,prizes:this.model.getPrizes(),stageWinners:this.stageWinners};localStorage.setItem("luckyDrawState",JSON.stringify(e))}loadGameState(){const e=localStorage.getItem("luckyDrawState");if(e)try{const t=JSON.parse(e);if(t.version!==q){this.clearGameState();return}this.currentStage=t.currentStage??0,this.stageWinners=t.stageWinners??[],this.model.setPrizes(t.prizes??[])}catch(t){console.error("Failed to load saved state",t)}}clearGameState(){localStorage.removeItem("luckyDrawState")}onStartGame(){this.hasSavedGame()?N.showConfirm(this.scene,"Do want to continue the previous game?","Resume","Restart",()=>{if(this.loadGameState(),this.view.reset(),this.stageWinners.forEach(e=>this.view.showStageWinnersPanel(e,()=>{})),this.currentStage>=this.stages.length)this.view.showGameCompleteSummary();else{const e=this.stages[this.currentStage].count;this.view.renderPrizePanel(this.model.getPrizes(),e)}this.curtainStageTransition(()=>this.startStage(this.currentStage))},()=>{this.clearGameState(),this.currentStage=0,this.stageWinners=[],this.curtainStageTransition(()=>this.startStage(0))}):(this.clearGameState(),this.currentStage=0,this.stageWinners=[],this.curtainStageTransition(()=>this.startStage(0)))}startStage(e){var s,a;this.clearAllBalls(),this.model.getPrizes().length===0&&this.model.clearPrizes();const t=this.stages[this.currentStage].count;this.view.renderPrizePanel(this.model.getPrizes(),t),this.maxCollect=this.stages[e].count,(a=(s=this.view).showStageLabel)==null||a.call(s,e),this.view.showGameScreen(()=>this.startInfiniteBallDrop()),this.view.showStagePrize(this.stagePrizes[e])}async fetchRandomPrizeInfo(){const e=await fetch(`${me}/users`);if(!e.ok)throw new Error("Failed to fetch prize info");const t=await e.json();return Array.isArray(t)?t[Math.floor(Math.random()*t.length)]:t}startInfiniteBallDrop(){this.ballSpawnTimer&&this.ballSpawnTimer.remove(!1),this.ballSpawnTimer=this.scene.time.addEvent({delay:300,loop:!0,callback:()=>{var e;if(this.model.getPrizes().length>=this.maxCollect){(e=this.ballSpawnTimer)==null||e.remove(!1);return}this.spawnBall()}})}spawnBall(){const{width:e,height:t}=this.scene.scale,s=Phaser.Math.Between(e*.015,e*.47),a=t*.16,n=Math.max(e,t)*.07,i=this.scene.add.image(s,a,"Ball").setOrigin(.5).setDisplaySize(n,n).setDepth(2).setInteractive({useHandCursor:!0});i.setAngle(Phaser.Math.Between(-45,45));const r=this.scene.tweens.add({targets:i,y:t*.98,angle:Phaser.Math.Between(-270,270),ease:"Sine.easeInOut",duration:Phaser.Math.Between(8500,15e3),delay:Phaser.Math.Between(0,700),onComplete:()=>{this.ballPairs=this.ballPairs.filter(o=>o.ball!==i),i.active&&i.destroy()}});this.ballPairs.push({ball:i,tween:r}),i.on("pointerdown",async()=>{if(!(this.isCollectingPrize||this.model.getPrizes().length>=this.maxCollect)){this.isCollectingPrize=!0,i.disableInteractive();try{const o=await this.fetchRandomPrizeInfo();this.collectPrizeWithAnimation(i,o)}catch(o){i.setInteractive({useHandCursor:!0}),this.isCollectingPrize=!1,console.error("Prize fetch failed",o)}}})}collectPrizeWithAnimation(e,t){const{width:s,height:a}=this.scene.scale;this.pauseAllBalls(),this.view.showPrizeCongratulation(t);const n=this.model.getPrizes().length,i=n%3,r=Math.floor(n/3),o=s*.14,u=a*.063,h=s*.007,m=s*.6+i*(o+h),c=a*.32+r*(u+h),l=this.scene.add.image(e.x,e.y,"Ball").setOrigin(.5).setDisplaySize(u,u).setDepth(100);this.scene.tweens.add({targets:l,x:m,y:c,scale:1.3,alpha:.6,duration:700,ease:"Cubic.easeIn",onComplete:()=>{l.destroy(),this.model.addPrize(t);const p=this.stages[this.currentStage].count;this.view.renderPrizePanel(this.model.getPrizes(),p),this.saveGameState(),this.model.getPrizes().length>=this.maxCollect&&this.onStageComplete()}}),this.scene.tweens.add({targets:e,scale:1.4,alpha:0,duration:200,onComplete:()=>{e.destroy(),this.ballPairs=this.ballPairs.filter(p=>p.ball!==e)}})}pauseAllBalls(){this.ballPairs.forEach(e=>{e.ball.active&&e.tween&&!e.tween.paused&&(e.tween.pause(),e.ball.disableInteractive())}),this.ballSpawnTimer&&(this.ballSpawnTimer.paused=!0)}resumeAllBalls(){this.ballPairs.forEach(e=>{e.ball.active&&e.tween&&e.tween.paused&&(e.tween.resume(),e.ball.setInteractive({useHandCursor:!0}))}),this.ballSpawnTimer&&(this.ballSpawnTimer.paused=!1)}onStageComplete(){this.clearAllBalls();const e=this.model.getPrizes();this.view.collectedPrizeGraphics.forEach(t=>t.destroy()),this.view.collectedPrizeGraphics=[],this.view.slideOutPeople(()=>{this.view.showStageWinnersPanel(e,()=>{this.stageWinners.push([...e]),this.currentStage++,this.currentStage<this.stages.length?(this.model.clearPrizes(),this.saveGameState(),this.curtainStageTransition(()=>this.startStage(this.currentStage))):(this.clearGameState(),this.curtainStageTransition(()=>{var t,s;(s=(t=this.view).showGameComplete)==null||s.call(t)}))})})}clearAllBalls(){this.ballPairs.forEach(e=>{var t,s;(t=e.tween)!=null&&t.isPlaying()&&e.tween.stop(),(s=e.ball)!=null&&s.active&&e.ball.destroy()}),this.ballPairs=[],this.ballSpawnTimer&&(this.ballSpawnTimer.remove(!1),this.ballSpawnTimer=void 0)}curtainStageTransition(e){this.view.closeCurtain(()=>{e(),this.view.openCurtain()})}}class Se extends F.Scene{constructor(){super({key:"LuckyDrawScene"});g(this,"model");g(this,"view")}preload(){this.model=new ie,this.view=new ue(this),this.view.preload()}create(){const t=this.cameras.main.centerX,s=this.cameras.main.centerY;this.view.createLayout(t,s),this.view.createLayout(t,s),new fe(this.model,this.view,this)}}const we={type:F.AUTO,width:1920,height:1080,backgroundColor:"#538b3c",scene:[ae,Se],parent:"game",scale:{mode:F.Scale.FIT,autoCenter:F.Scale.CENTER_BOTH,width:1920,height:1080}};new F.Game(we);
